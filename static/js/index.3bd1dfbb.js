(()=>{"use strict";var e={7985:function(e,t,n){var r=n(5893),o=n(7294),l=n(745),i=n(8649),s=n(9832),a=n.n(s);let c=e=>{let{id:t,clusters:n,height:l,dblclickedOn:s}=e,a=(0,o.useRef)(null),c=(0,o.useRef)(null),[d,h]=(0,o.useState)(0),g=(0,o.useRef)(0),[u,p]=(0,o.useState)({show:!1,content:"",x:0,y:0}),[f,x]=(0,o.useState)(10),m=(0,o.useRef)(null),[v,y]=(0,o.useState)(0);(0,o.useEffect)(()=>{let e=c.current;if(!e)return;let t=new ResizeObserver(e=>{for(let t of e)h(t.contentRect.width)});return t.observe(e),()=>t.disconnect()},[]);let j=(e,t,n,r,o)=>{let l=n+12+r,i=n+12+t-r,s=o(e.start),a=o(e.end),c=(l+i)/2,d=Math.max(o(e.end)-2*r,s),h=Math.min(o(e.start)+2*r,a);if(1==e.strand){let e=""+s+","+l;return e+(" "+d+","+l+(" "+a+",")+c+(" "+d+",")+i+(" "+s+",")+i)}if(-1==e.strand){let e=""+s+","+c;return e+(" "+h+","+l+(" "+a+",")+l+(" "+a+",")+i+(" "+h+",")+i)}if(0==e.strand){let e=""+s+","+l;return e+(" "+a+","+l+(" "+a+",")+i+(" "+s+",")+i)}},b=(e,t,n,r,o)=>{let l=n+12+t-r,i=o(e.start),s=o(e.end),a=""+i+","+l;return a+(" "+(i+s)/2+","+(n+12+r)+(" "+s+",")+l+(" "+i+",")+l)},_=(e,t,n,r,o)=>{let l=n+12+r,i=n+12+t-r,s=o(e.start),a=o(e.end),c=(s+a)/2,d=(l+i)/2,h=""+s+","+d;return h+(" "+c+","+l+(" "+a+",")+d+(" "+c+",")+i+(" "+s+",")+d)},S=(e,t,n,r,o,l,a,c,d,h,g,u)=>{let f=e.contigLength,x=l(0),v=Number(l(f*(e.start+e.end>0?1:-1))),y=function(n,r,o){t.selectAll("polygon.orthoplot-gene-"+n).data(o).enter().append("polygon").attr("points",function(e){return r(e,d,g*a,u,l)}).attr("class",function(e){return"orthoplot-type-"+e.type+" orthoplot-gene-"+n+" orthoplot-gene"}).attr("id",function(t){return c+"-cluster"+e.idx+"-"+C(t.geneName)+"-orf"}).attr("name",function(e){return e.ortho_tag?e.ortho_tag:null}).attr("style",function(e){if(void 0!==e.color&&"CDS"==e.type)return"fill:"+e.color}).on("mouseover",function(e,t){let n=t.ortho_tag,r=(n?"ortho_tag="+n+"<br>":"")+t.description;p({show:!0,content:r,x:e.pageX+10,y:e.pageY-10}),m.current.innerHTML=r}).on("mouseout",()=>{p(e=>({...e,show:!1}))}).on("dblclick",function(e,t){let n=i.Ys(e.target).datum();s(e,n)})};t.append("line").attr("x1",Math.min(h,Math.max(x,0))).attr("y1",g*a+12+d/2).attr("x2",Math.max(0,Math.min(h,v))).attr("y2",g*a+12+d/2).attr("class","orthoplot-line"),y("CDS",j,n),y("RNA",b,o),y("repeat",_,r)},w=()=>{if(!n)return;let e=v*f,t=n.slice(e,e+f),r=i.Ys(a.current),o=l+24;r.selectAll("*").remove();let s=r.attr("height",o*t.length).attr("width","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${d} ${o*t.length}`),c=[],h=[],u=[];t.forEach((e,t)=>{c.push(...e.genes.filter(e=>"CDS"===e.type)),h.push(...e.genes.filter(e=>e.type.match(/RNA/))),u.push(...e.genes.filter(e=>e.type.match(/repeat/)));let n=g.current++,r=l/10,a=i.BYU().domain([e.start,e.end]).range([0,d]);S(e,s,c,u,h,a,t,n,l,d,o,r),e.label&&s.append("text").text(e.label).attr("class","orthoplot-clusterlabel").attr("x",function(){return d-this.getComputedTextLength()-5}).attr("y",()=>o*t+12).attr("font-size",12)})},C=e=>e.replace(/(:|\.)/g,"-").replace(/-orf/g,"_orf");return(0,o.useEffect)(()=>{w()},[n,l,d,f,v]),(0,r.jsxs)("div",{style:{height:"95vh",display:"flex",flexDirection:"column",padding:"10px",boxSizing:"border-box"},children:[(()=>{if((null==n?void 0:n.length)<=10)return null;let e=Math.ceil(n.length/f),t=(v+1)*f<n.length,o=v>0;return(0,r.jsxs)("div",{style:{textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,r.jsx)("button",{onClick:()=>y(v-1),disabled:!o,style:{opacity:o?1:.5},children:"←"}),(0,r.jsx)("button",{onClick:()=>{x(10),y(0)},style:{fontWeight:10===f?"bold":"normal",margin:"0 5px"},children:"Show 10"}),(0,r.jsx)("button",{onClick:()=>{x(20),y(0)},style:{fontWeight:20===f?"bold":"normal",margin:"0 5px"},children:"Show 20"}),n.length>20&&(0,r.jsx)("button",{onClick:()=>{x(50),y(0)},style:{fontWeight:50===f?"bold":"normal",margin:"0 5px"},children:"Show 50"}),(0,r.jsx)("button",{onClick:()=>y(v+1),disabled:!t,style:{opacity:t?1:.5},children:"→"}),(0,r.jsxs)("span",{style:{marginLeft:"10px"},children:["Page ",v+1," of ",e]})]})})(),(0,r.jsx)("div",{id:t,ref:c,style:{flex:1,border:"1px solid #ccc",overflow:"auto",userSelect:"none",width:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsx)("svg",{ref:a,style:{minHeight:"min-content"}})}),(0,r.jsx)("div",{className:"tooltip",style:{position:"fixed",left:u.x,top:u.y,opacity:.9*!!u.show,pointerEvents:"none",backgroundColor:"lightgray",border:"1px solid #ccc",padding:"5px",borderRadius:"4px",boxShadow:"2px 2px 4px rgba(0,0,0,0.1)",display:u.show?"block":"none"},ref:m})]})};var d=n(256),h=n(7412),g=n(749);class u{set_attr(e,t){this[e]=t}to_dict(){return Object.assign({},this)}to_json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return JSON.stringify(this,null,e)}toString(){return JSON.stringify(this.to_dict())}}class p extends u{addContig(e){this.contigs.push(e)}to_dict(){let e={genomeName:this.genomeName,contigs:this.contigs};return Object.keys(this).forEach(t=>{"genomeName"!==t&&"contigs"!==t&&(e[t]=this[t])}),e}constructor(e){super(),(0,h._)(this,"genomeName",void 0),(0,h._)(this,"contigs",[]),this.genomeName=e}}class f extends u{addGene(e){this.genes.push(e)}constructor(e){super(),(0,h._)(this,"contigName",void 0),(0,h._)(this,"genes",[]),this.contigName=e}}class x extends u{constructor(e,t,n,r,o,l=""){super(),(0,h._)(this,"geneName",void 0),(0,h._)(this,"start",void 0),(0,h._)(this,"end",void 0),(0,h._)(this,"strand",void 0),(0,h._)(this,"description",void 0),(0,h._)(this,"type",void 0),this.geneName=e,this.start=t,this.end=n,this.strand=r,this.type=o,this.description=l}}var m=n(9891),v=n(4817),y=n(2401),j=n(2504),b=n(7230),_=n(9836),S=n(7674),w=n(1864),C=n(7454),N=n(2149);l.createRoot(document.getElementById("root")).render((0,r.jsx)(o.StrictMode,{children:(0,r.jsx)(N.VK,{children:(0,r.jsx)(function(){var e,t;let[n,l]=(0,o.useState)(5e3),[s,h]=(0,o.useState)(20),[u,N]=(0,o.useState)(null),[F,O]=(0,o.useState)({}),[k,E]=(0,o.useState)([]),[M,D]=(0,o.useState)(""),[R,P]=(0,o.useState)([]),[Z,$]=(0,o.useState)([]),[z,A]=(0,o.useState)({open:!1,position:{x:0,y:0},gene:null}),[I,W]=(0,o.useState)(""),T=(0,o.useRef)(null),H=(0,o.useRef)(null);(0,o.useEffect)(()=>{u&&E([...new Set(a().query(u,"$..ortho_tag").filter(Boolean))])},[u]),(0,o.useEffect)(()=>{u&&M&&q()},[u,M]),(0,o.useEffect)(()=>{F&&u&&(N(u.map(e=>({...e,contigs:e.contigs.map(e=>({...e,genes:e.genes.map(e=>({...e,ortho_tag:F[e.geneName]||e.ortho_tag}))}))}))),D(F[Object.keys(F)[0]]||""),q())},[F]),(0,o.useEffect)(()=>{u&&M&&q()},[n,s]);let L=()=>{A(e=>({...e,open:!1})),W("")},Y=e=>{var t;(null===(t=z.gene)||void 0===t?void 0:t.ortho_tag)&&(P(t=>t.map(t=>t.ortho_tag===z.gene.ortho_tag?{...t,color:e}:t)),$(t=>t.map(t=>({...t,genes:t.genes.map(t=>t.ortho_tag===z.gene.ortho_tag?{...t,color:e}:t)}))))},B=(e,t)=>u?u.map(function(n){let r=n.genomeName,o=n.speciesName;return n.contigs.map(function(n){let l=n.contigName,i=n.contigLength;return n.genes.filter(t=>t.ortho_tag==e).map(function(e){let s=Math.floor(.5*(e.start+e.end));return -1==e.strand?{start:-s-t,end:-s+t,idx:r,label:r+":"+l+"(-) "+o,contigLength:i,genes:n.genes.filter(e=>-e.start>=-s-t&&-e.end<=-s+t).map(e=>({geneName:e.geneName,start:-e.end,end:-e.start,strand:-1*e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}:{start:s-t,end:s+t,idx:r,label:r+":"+l+"(+) "+o,contigLength:i,genes:n.genes.filter(e=>e.end>=s-t&&e.start<=s+t).map(e=>({geneName:e.geneName,start:e.start,end:e.end,strand:e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}})})}).flat(2):[],G=(e,t)=>{let n=e.filter(e=>t.includes(e.ortho_tag)),r=t.filter(e=>!n.map(e=>e.ortho_tag).includes(e)),o=[...i.UCG,...i.W1Y,...i.xHP,...i.K2I],l=n.map(e=>e.color),s=o.filter(e=>!l.includes(e));for(;s.length<r.length;){let e=i.B8C(255*Math.random(),255*Math.random(),255*Math.random()).formatHex();s.includes(e)||l.includes(e)||s.push(e)}return[...r.map((e,t)=>({ortho_tag:e,color:s[t]})),...n]},J=(e,t)=>{let n=B(e,t),r=a().query(n,"$..ortho_tag"),o=r.reduce((e,t)=>(t&&(e[t]=(e[t]||0)+1),e),{}),l=G(R,[...new Set(r)].filter(Boolean).sort((e,t)=>o[t]-o[e]));return P(l),n.forEach(e=>{e.genes.forEach(e=>{let t=l.find(t=>t.ortho_tag===e.ortho_tag);e.color=t?t.color:"#FFFFFF"})}),n},q=()=>{$(J(M,n))},K=(e,t)=>{null==e||e.preventDefault(),t&&(D(t),q())},X=e=>t=>{e(parseInt(t.target.value)),q()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginTop:"1em"},children:[(0,r.jsx)("div",{id:"cluster",ref:T,style:{flexGrow:1},children:(0,r.jsx)(c,{id:"orthoplot",clusters:Z,height:s,dblclickedOn:(e,t)=>{A({open:!0,position:{x:e.pageX,y:e.pageY},gene:t})}})}),(0,r.jsxs)("div",{className:"div-floater",ref:H,children:[(0,r.jsx)("form",{onSubmit:e=>e.preventDefault(),children:(0,r.jsx)(m.Z,{value:M||"",options:k,onKeyDown:e=>{"Enter"===e.key&&e.target.value&&K(e,e.target.value)},onBlur:e=>{e.target.value&&K(e,e.target.value)},renderInput:e=>(0,r.jsx)(v.Z,{...e,label:"Enter orthoID",variant:"outlined",size:"small",fullWidth:!0}),sx:{mb:2}})}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"panelHeight",children:["Panel Height: ",s]}),(0,r.jsx)("input",{type:"range",id:"panelHeight",min:"5",max:"100",value:s,onChange:X(h)})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"flankSize",children:["Flanking region Size (bp): ",n]}),(0,r.jsx)("input",{type:"range",id:"flankSize",min:"1000",max:"100000",value:n,onChange:X(l)})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"gffDirectory",children:"GFF Directory: "}),(0,r.jsx)("input",{type:"file",id:"gffDirectory",webkitdirectory:"true",directory:"true",multiple:!0,onChange:e=>{let t=Array.from(e.target.files).filter(e=>e.name.endsWith(".gff")||e.name.endsWith(".gff3"));if(0===t.length){alert("No .gff or .gff3 files found");return}let n=[];t.forEach(e=>{let t=new FileReader;t.onload=t=>{let r=t.target.result,o=function(e,t){let n=new p(e),r={};for(let e of t.split("\n"))if(e.startsWith("##sequence-region")){let t=e.split(/\s+/);if(t.length>=3){let e=t[1],n=parseInt(t[3],10);r[e]=n}}let o=(0,g.X)(t);var l={},i=-1;return o.forEach(e=>{let t=e[0].seq_id;l[t]||(l[t]=new f(t)),l[t].set_attr("contigLength",r[t]||0);let n=e[0].type,o=e[0].start-1,s=e[0].end,a="+"===e[0].strand?1:"-"===e[0].strand?-1:0,c=[`pos=${o}-${s}`];Object.entries(e[0].attributes).forEach(e=>{let[t,n]=e;!["source","phase"].includes(t)&&Array.isArray(n)&&c.push(`${t}=${n[0]}`)});var d=e[0].attributes.ID?e[0].attributes.ID[0]:`unknown_${o}_${s}`;"repeat_region"===n?(i+=1,d=`${t}_repeat_${i}`):i=-1;let h=new x(d,o,s,a,n,c.join("<br>"));l[t].addGene(h)}),Object.values(l).forEach(e=>{n.addContig(e)}),n}(e.name.split(".")[0],r);n.push(o)},t.readAsText(e)}),console.log(n),N(n)},accept:".gff,.gff3"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"txtFile",children:"Orthos File: "}),(0,r.jsx)("input",{type:"file",id:"txtFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".txt")){alert("Please select a .txt file");return}let n=new FileReader;n.onload=e=>{let t=e.target.result.split("\n"),n={};for(let e of t){if(""===e.trim()||e.startsWith("#"))continue;let t=e.split(/\s+/);if(t.length>=2){let e=t[0],r=t[1];n[e]=r}}O(n)},n.readAsText(t)},accept:".txt"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"jsonFile",children:"JSON File: "}),(0,r.jsx)("input",{type:"file",id:"jsonFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".json")){alert("Please select a .json file");return}let n=new FileReader;n.onload=e=>{try{let t=JSON.parse(e.target.result);t[0]&&t[0].contigs&&console.log("First 5 contigs:",t[0].contigs.slice(0,5).map(e=>{var t;return{name:e.contigName,length:e.contigLength,geneCount:(null===(t=e.genes)||void 0===t?void 0:t.length)||0}})),N(t);let n=a().query(t,"$..ortho_tag");D(n[0])}catch(e){alert("Invalid JSON file format"),console.error("Error parsing JSON:",e)}},n.readAsText(t)},accept:".json"})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("button",{className:"btn btn-primary",onClick:()=>{let e={filename:`GeneNeighborhood_${Date.now()}`};d.save(i.Ys("svg").node(),e)},children:[(0,r.jsx)("i",{className:"fa fa-download"})," Download SVG"]})]})]}),(0,r.jsxs)(y.Z,{open:z.open,onClose:L,anchorReference:"anchorPosition",anchorPosition:z.open?{top:z.position.y,left:z.position.x}:void 0,children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px"},children:[(0,r.jsx)(v.Z,{label:"New Ortho Tag",value:I,onChange:e=>W(e.target.value),size:"small",fullWidth:!0,sx:{mb:1}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,r.jsx)(b.Z,{size:"small",onClick:L,children:"Cancel"}),(0,r.jsx)(b.Z,{variant:"contained",size:"small",onClick:()=>{if(!z.gene||!I)return;let e=[...u];e.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{e.geneName===z.gene.geneName&&(e.ortho_tag=I)})})}),N(e),D(I),L(),q()},disabled:!I,children:"Add & Center"})]})]})}),(null===(e=z.gene)||void 0===e?void 0:e.ortho_tag)&&(0,r.jsxs)("div",{children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px",width:"200px"},children:[(0,r.jsx)("p",{style:{margin:"0 0 8px 0"},children:"Change Color"}),(0,r.jsx)(_.Ov,{format:"hex",value:(null===(t=R.find(e=>{var t;return e.ortho_tag===(null===(t=z.gene)||void 0===t?void 0:t.ortho_tag)}))||void 0===t?void 0:t.color)||"#FFFFFF",onChange:Y})]})}),(0,r.jsxs)(j.Z,{onClick:()=>Y("#FFFFFF"),sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(w.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Clear Color"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{D(z.gene.ortho_tag),L(),q()},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(S.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Center"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{z.gene&&u&&(N(u.map(e=>({...e,contigs:e.contigs.filter(e=>!e.genes.some(e=>e.geneName===z.gene.geneName))}))),L(),q())},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,r.jsx)(C.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Delete Contig"})]})]})]})]})},{})})}))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var l=t[r]={exports:{}};return e[r].call(l.exports,l,l.exports,n),l.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o||"object"==typeof r&&r&&(4&o&&r.__esModule||16&o&&"function"==typeof r.then))return r;var l=Object.create(null);n.r(l);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>{i[e]=()=>r[e]});return i.default=()=>r,n.d(l,i),l}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},(()=>{n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,r,o,l)=>{if(r){l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[r,o,l];return}for(var s=1/0,i=0;i<e.length;i++){for(var[r,o,l]=e[i],a=!0,c=0;c<r.length;c++)(!1&l||s>=l)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(a=!1,l<s&&(s=l));if(a){e.splice(i--,1);var d=o();void 0!==d&&(t=d)}}return t}})(),n.rv=()=>"1.2.8",(()=>{var e={980:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,l,[i,s,a]=r,c=0;if(i.some(t=>0!==e[t])){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(a)var d=a(n)}for(t&&t(r);c<i.length;c++)l=i[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},r=self.webpackChunksample_app=self.webpackChunksample_app||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.2.8";var r=n.O(void 0,["361","118","425"],function(){return n(7985)});r=n.O(r)})();