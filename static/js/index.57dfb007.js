(()=>{"use strict";var e={7985:function(e,t,n){var r=n(5893),o=n(7294),i=n(745),l=n(8649),s=n(9832),a=n.n(s);let c=e=>{let{id:t,clusters:n,height:i,dblclickedOn:s}=e,a=(0,o.useRef)(null),c=(0,o.useRef)(null),[d,h]=(0,o.useState)(0),g=(0,o.useRef)(0),[u,f]=(0,o.useState)({show:!1,content:"",x:0,y:0}),[p,x]=(0,o.useState)(10),m=(0,o.useRef)(null),[v,y]=(0,o.useState)(0);(0,o.useEffect)(()=>{let e=c.current;if(!e)return;let t=new ResizeObserver(e=>{for(let t of e)h(t.contentRect.width)});return t.observe(e),()=>t.disconnect()},[]);let j=(e,t,n,r,o)=>{let i=n+12+r,l=n+12+t-r,s=o(e.start),a=o(e.end),c=(i+l)/2,d=Math.max(o(e.end)-2*r,s),h=Math.min(o(e.start)+2*r,a);if(1==e.strand){let e=""+s+","+i;return e+(" "+d+","+i+(" "+a+",")+c+(" "+d+",")+l+(" "+s+",")+l)}if(-1==e.strand){let e=""+s+","+c;return e+(" "+h+","+i+(" "+a+",")+i+(" "+a+",")+l+(" "+h+",")+l)}if(0==e.strand){let e=""+s+","+i;return e+(" "+a+","+i+(" "+a+",")+l+(" "+s+",")+l)}},b=(e,t,n,r,o)=>{let i=n+12+t-r,l=o(e.start),s=o(e.end),a=""+l+","+i;return a+(" "+(l+s)/2+","+(n+12+r)+(" "+s+",")+i+(" "+l+",")+i)},_=(e,t,n,r,o)=>{let i=n+12+r,l=n+12+t-r,s=o(e.start),a=o(e.end),c=(s+a)/2,d=(i+l)/2,h=""+s+","+d;return h+(" "+c+","+i+(" "+a+",")+d+(" "+c+",")+l+(" "+s+",")+d)},S=(e,t,n,r,o,i,a,c,d,h,g,u)=>{let p=e.contigLength,x=i(0),v=Number(i(p*(e.start+e.end>0?1:-1))),y=function(n,r,o){t.selectAll("polygon.orthoplot-gene-"+n).data(o).enter().append("polygon").attr("points",function(e){return r(e,d,g*a,u,i)}).attr("class",function(e){return"orthoplot-type-"+e.type+" orthoplot-gene-"+n+" orthoplot-gene"}).attr("id",function(t){return c+"-cluster"+e.idx+"-"+C(t.geneName)+"-orf"}).attr("name",function(e){return e.ortho_tag?e.ortho_tag:null}).attr("style",function(e){if(void 0!==e.color&&"CDS"==e.type)return"fill:"+e.color}).on("mouseover",function(e,t){let n=t.ortho_tag,r=(n?"ortho_tag="+n+"<br>":"")+t.description;f({show:!0,content:r,x:e.pageX+10,y:e.pageY-10}),m.current.innerHTML=r}).on("mouseout",()=>{f(e=>({...e,show:!1}))}).on("dblclick",function(e,t){let n=l.Ys(e.target).datum();s(e,n)})};t.append("line").attr("x1",Math.min(h,Math.max(x,0))).attr("y1",g*a+12+d/2).attr("x2",Math.max(0,Math.min(h,v))).attr("y2",g*a+12+d/2).attr("class","orthoplot-line"),y("CDS",j,n),y("RNA",b,o),y("repeat",_,r)},w=()=>{if(!n)return;let e=v*p,t=n.slice(e,e+p),r=l.Ys(a.current),o=i+24;r.selectAll("*").remove();let s=r.attr("height",o*t.length).attr("width","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${d} ${o*t.length}`),c=[],h=[],u=[];t.forEach((e,t)=>{c.push(...e.genes.filter(e=>"CDS"===e.type)),h.push(...e.genes.filter(e=>e.type.match(/RNA/))),u.push(...e.genes.filter(e=>e.type.match(/repeat/)));let n=g.current++,r=i/10,a=l.BYU().domain([e.start,e.end]).range([0,d]);S(e,s,c,u,h,a,t,n,i,d,o,r),e.label&&s.append("text").text(e.label).attr("class","orthoplot-clusterlabel").attr("x",function(){return d-this.getComputedTextLength()-5}).attr("y",()=>o*t+12).attr("font-size",12)})},C=e=>e.replace(/(:|\.)/g,"-").replace(/-orf/g,"_orf");return(0,o.useEffect)(()=>{w()},[n,i,d,p,v]),(0,r.jsxs)("div",{style:{height:"95vh",display:"flex",flexDirection:"column",padding:"10px",boxSizing:"border-box"},children:[(()=>{if((null==n?void 0:n.length)<=10)return null;let e=Math.ceil(n.length/p),t=(v+1)*p<n.length,o=v>0;return(0,r.jsxs)("div",{style:{textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,r.jsx)("button",{onClick:()=>y(v-1),disabled:!o,style:{opacity:o?1:.5},children:"←"}),(0,r.jsx)("button",{onClick:()=>{x(10),y(0)},style:{fontWeight:10===p?"bold":"normal",margin:"0 5px"},children:"Show 10"}),(0,r.jsx)("button",{onClick:()=>{x(20),y(0)},style:{fontWeight:20===p?"bold":"normal",margin:"0 5px"},children:"Show 20"}),n.length>20&&(0,r.jsx)("button",{onClick:()=>{x(50),y(0)},style:{fontWeight:50===p?"bold":"normal",margin:"0 5px"},children:"Show 50"}),(0,r.jsx)("button",{onClick:()=>y(v+1),disabled:!t,style:{opacity:t?1:.5},children:"→"}),(0,r.jsxs)("span",{style:{marginLeft:"10px"},children:["Page ",v+1," of ",e]})]})})(),(0,r.jsx)("div",{id:t,ref:c,style:{flex:1,border:"1px solid #ccc",overflow:"auto",userSelect:"none",width:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsx)("svg",{ref:a,style:{minHeight:"min-content"}})}),(0,r.jsx)("div",{className:"tooltip",style:{position:"fixed",left:u.x,top:u.y,opacity:.9*!!u.show,pointerEvents:"none",backgroundColor:"lightgray",border:"1px solid #ccc",padding:"5px",borderRadius:"4px",boxShadow:"2px 2px 4px rgba(0,0,0,0.1)",display:u.show?"block":"none"},ref:m})]})};var d=n(256),h=n(7412),g=n(749);class u{set_attr(e,t){this[e]=t}to_dict(){return Object.assign({},this)}to_json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return JSON.stringify(this,null,e)}toString(){return JSON.stringify(this.to_dict())}}class f extends u{addContig(e){this.contigs.push(e)}to_dict(){let e={genomeName:this.genomeName,contigs:this.contigs};return Object.keys(this).forEach(t=>{"genomeName"!==t&&"contigs"!==t&&(e[t]=this[t])}),e}constructor(e){super(),(0,h._)(this,"genomeName",void 0),(0,h._)(this,"contigs",[]),this.genomeName=e}}class p extends u{addGene(e){this.genes.push(e)}constructor(e){super(),(0,h._)(this,"contigName",void 0),(0,h._)(this,"genes",[]),this.contigName=e}}class x extends u{constructor(e,t,n,r,o,i=""){super(),(0,h._)(this,"geneName",void 0),(0,h._)(this,"start",void 0),(0,h._)(this,"end",void 0),(0,h._)(this,"strand",void 0),(0,h._)(this,"description",void 0),(0,h._)(this,"type",void 0),this.geneName=e,this.start=t,this.end=n,this.strand=r,this.type=o,this.description=i}}var m=n(9891),v=n(4817),y=n(2401),j=n(2504),b=n(7230),_=n(9836),S=n(7674),w=n(1864),C=n(2149);i.createRoot(document.getElementById("root")).render((0,r.jsx)(o.StrictMode,{children:(0,r.jsx)(C.VK,{children:(0,r.jsx)(function(){var e,t;let[n,i]=(0,o.useState)(5e3),[s,h]=(0,o.useState)(20),[u,C]=(0,o.useState)(null),[N,F]=(0,o.useState)({}),[O,E]=(0,o.useState)([]),[k,M]=(0,o.useState)(""),[R,D]=(0,o.useState)([]),[P,$]=(0,o.useState)([]),[A,z]=(0,o.useState)({open:!1,position:{x:0,y:0},gene:null}),[I,W]=(0,o.useState)(""),Z=(0,o.useRef)(null),T=(0,o.useRef)(null);(0,o.useEffect)(()=>{u&&E([...new Set(a().query(u,"$..ortho_tag").filter(Boolean))])},[u]),(0,o.useEffect)(()=>{u&&k&&J()},[u,k,N]),(0,o.useEffect)(()=>{N&&u&&u.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{N[e.geneName]&&(e.ortho_tag=N[e.geneName])})})})},[N]),(0,o.useEffect)(()=>{u&&k&&J()},[n,s]);let H=()=>{z(e=>({...e,open:!1})),W("")},L=e=>{var t;(null===(t=A.gene)||void 0===t?void 0:t.ortho_tag)&&(D(t=>t.map(t=>t.ortho_tag===A.gene.ortho_tag?{...t,color:e}:t)),$(t=>t.map(t=>({...t,genes:t.genes.map(t=>t.ortho_tag===A.gene.ortho_tag?{...t,color:e}:t)}))))},Y=(e,t)=>u?u.map(function(n){let r=n.genomeName,o=n.speciesName;return n.contigs.map(function(n){let i=n.contigName,l=n.contigLength;return n.genes.filter(t=>t.ortho_tag==e).map(function(e){let s=Math.floor(.5*(e.start+e.end));return -1==e.strand?{start:-s-t,end:-s+t,idx:r,label:r+":"+i+"(-) "+o,contigLength:l,genes:n.genes.filter(e=>-e.start>=-s-t&&-e.end<=-s+t).map(e=>({geneName:e.geneName,start:-e.end,end:-e.start,strand:-1*e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}:{start:s-t,end:s+t,idx:r,label:r+":"+i+"(+) "+o,contigLength:l,genes:n.genes.filter(e=>e.end>=s-t&&e.start<=s+t).map(e=>({geneName:e.geneName,start:e.start,end:e.end,strand:e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}})})}).flat(2):[],G=(e,t)=>{let n=e.filter(e=>t.includes(e.ortho_tag)),r=t.filter(e=>!n.map(e=>e.ortho_tag).includes(e)),o=[...l.UCG,...l.W1Y,...l.xHP,...l.K2I],i=n.map(e=>e.color),s=o.filter(e=>!i.includes(e));for(;s.length<r.length;){let e=l.B8C(255*Math.random(),255*Math.random(),255*Math.random()).formatHex();s.includes(e)||i.includes(e)||s.push(e)}return[...r.map((e,t)=>({ortho_tag:e,color:s[t]})),...n]},B=(e,t)=>{let n=Y(e,t),r=a().query(n,"$..ortho_tag"),o=r.reduce((e,t)=>(t&&(e[t]=(e[t]||0)+1),e),{}),i=G(R,[...new Set(r)].filter(Boolean).sort((e,t)=>o[t]-o[e]));return D(i),n.forEach(e=>{e.genes.forEach(e=>{let t=i.find(t=>t.ortho_tag===e.ortho_tag);e.color=t?t.color:"#FFFFFF"})}),n},J=()=>{$(B(k,n))},q=(e,t)=>{if(null==e||e.preventDefault(),!t){alert("Empty value");return}M(t),J()},X=e=>t=>{e(parseInt(t.target.value)),J()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginTop:"1em"},children:[(0,r.jsx)("div",{id:"cluster",ref:Z,style:{flexGrow:1},children:(0,r.jsx)(c,{id:"orthoplot",clusters:P,height:s,dblclickedOn:(e,t)=>{z({open:!0,position:{x:e.pageX,y:e.pageY},gene:t})}})}),(0,r.jsxs)("div",{className:"div-floater",ref:T,children:[(0,r.jsx)("form",{onSubmit:e=>e.preventDefault(),children:(0,r.jsx)(m.Z,{value:k||"",onChange:(e,t)=>q(e,t),options:O,renderInput:e=>(0,r.jsx)(v.Z,{...e,label:"Enter orthoID",variant:"outlined",size:"small",fullWidth:!0}),sx:{mb:2}})}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"panelHeight",children:["Panel Height: ",s]}),(0,r.jsx)("input",{type:"range",id:"panelHeight",min:"5",max:"100",value:s,onChange:X(h)})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"flankSize",children:["Flanking region Size (bp): ",n]}),(0,r.jsx)("input",{type:"range",id:"flankSize",min:"1000",max:"100000",value:n,onChange:X(i)})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"gffDirectory",children:"GFF Directory: "}),(0,r.jsx)("input",{type:"file",id:"gffDirectory",webkitdirectory:"true",directory:"true",multiple:!0,onChange:e=>{let t=Array.from(e.target.files).filter(e=>e.name.endsWith(".gff")||e.name.endsWith(".gff3"));if(0===t.length){alert("No .gff or .gff3 files found");return}let n=[];t.forEach(e=>{let t=new FileReader;t.onload=t=>{let r=t.target.result,o=function(e,t){let n=new f(e),r={};for(let e of t.split("\n"))if(e.startsWith("##sequence-region")){let t=e.split(/\s+/);if(t.length>=3){let e=t[1],n=parseInt(t[3],10);r[e]=n}}let o=(0,g.X)(t);var i={},l=-1;return o.forEach(e=>{let t=e[0].seq_id;i[t]||(i[t]=new p(t)),i[t].set_attr("contigLength",r[t]||0);let n=e[0].type,o=e[0].start-1,s=e[0].end,a="+"===e[0].strand?1:"-"===e[0].strand?-1:0,c=[`pos=${o}-${s}`];Object.entries(e[0].attributes).forEach(e=>{let[t,n]=e;!["source","phase"].includes(t)&&Array.isArray(n)&&c.push(`${t}=${n[0]}`)});var d=e[0].attributes.ID?e[0].attributes.ID[0]:`unknown_${o}_${s}`;"repeat_region"===n?(l+=1,d=`${t}_repeat_${l}`):l=-1;let h=new x(d,o,s,a,n,c.join("<br>"));i[t].addGene(h)}),Object.values(i).forEach(e=>{n.addContig(e)}),n}(e.name.split(".")[0],r);n.push(o)},t.readAsText(e)}),C(n)},accept:".gff,.gff3"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"txtFile",children:"Orthos File: "}),(0,r.jsx)("input",{type:"file",id:"txtFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".txt")){alert("Please select a .txt file");return}let n=new FileReader;n.onload=e=>{let t=e.target.result.split("\n"),n={};for(let e of t){if(""===e.trim()||e.startsWith("#"))continue;let t=e.split(/\s+/);if(t.length>=2){let e=t[0],r=t[1];n[e]=r}}F(n)},n.readAsText(t)},accept:".txt"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"jsonFile",children:"JSON File: "}),(0,r.jsx)("input",{type:"file",id:"jsonFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".json")){alert("Please select a .json file");return}let n=new FileReader;n.onload=e=>{try{let t=JSON.parse(e.target.result);t[0]&&t[0].contigs&&console.log("First 5 contigs:",t[0].contigs.slice(0,5).map(e=>{var t;return{name:e.contigName,length:e.contigLength,geneCount:(null===(t=e.genes)||void 0===t?void 0:t.length)||0}})),C(t);let n=a().query(t,"$..ortho_tag");M(n[0])}catch(e){alert("Invalid JSON file format"),console.error("Error parsing JSON:",e)}},n.readAsText(t)},accept:".json"})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("button",{className:"btn btn-primary",onClick:()=>{let e={filename:`GeneNeighborhood_${Date.now()}`};d.save(l.Ys("svg").node(),e)},children:[(0,r.jsx)("i",{className:"fa fa-download"})," Download SVG"]})]})]}),(0,r.jsxs)(y.Z,{open:A.open,onClose:H,anchorReference:"anchorPosition",anchorPosition:A.open?{top:A.position.y,left:A.position.x}:void 0,children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px"},children:[(0,r.jsx)(v.Z,{label:"New Ortho Tag",value:I,onChange:e=>W(e.target.value),size:"small",fullWidth:!0,sx:{mb:1}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,r.jsx)(b.Z,{size:"small",onClick:H,children:"Cancel"}),(0,r.jsx)(b.Z,{variant:"contained",size:"small",onClick:()=>{if(!A.gene||!I)return;let e=[...u];e.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{e.geneName===A.gene.geneName&&(e.ortho_tag=I)})})}),C(e),M(I),H(),J()},disabled:!I,children:"Add & Center"})]})]})}),(null===(e=A.gene)||void 0===e?void 0:e.ortho_tag)&&(0,r.jsxs)("div",{children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px",width:"200px"},children:[(0,r.jsx)("p",{style:{margin:"0 0 8px 0"},children:"Change Color"}),(0,r.jsx)(_.Ov,{format:"hex",value:(null===(t=R.find(e=>{var t;return e.ortho_tag===(null===(t=A.gene)||void 0===t?void 0:t.ortho_tag)}))||void 0===t?void 0:t.color)||"#FFFFFF",onChange:L})]})}),(0,r.jsxs)(j.Z,{onClick:()=>L("#FFFFFF"),sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(w.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Clear Color"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{M(A.gene.ortho_tag),H(),J()},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(S.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Center"})]})]})]})]})},{})})}))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o||"object"==typeof r&&r&&(4&o&&r.__esModule||16&o&&"function"==typeof r.then))return r;var i=Object.create(null);n.r(i);var l={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>{l[e]=()=>r[e]});return l.default=()=>r,n.d(i,l),i}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},(()=>{n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,r,o,i)=>{if(r){i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[r,o,i];return}for(var s=1/0,l=0;l<e.length;l++){for(var[r,o,i]=e[l],a=!0,c=0;c<r.length;c++)(!1&i||s>=i)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(a=!1,i<s&&(s=i));if(a){e.splice(l--,1);var d=o();void 0!==d&&(t=d)}}return t}})(),n.rv=()=>"1.2.8",(()=>{var e={980:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,i,[l,s,a]=r,c=0;if(l.some(t=>0!==e[t])){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(a)var d=a(n)}for(t&&t(r);c<l.length;c++)i=l[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},r=self.webpackChunksample_app=self.webpackChunksample_app||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.2.8";var r=n.O(void 0,["361","118","987"],function(){return n(7985)});r=n.O(r)})();