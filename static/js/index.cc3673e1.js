(()=>{"use strict";var e={7985:function(e,t,n){var r=n(5893),o=n(7294),l=n(745),i=n(6212),s=n(9832),a=n.n(s);let c=e=>{let{id:t,clusters:n,height:l,dblclickedOn:s}=e,a=(0,o.useRef)(null),c=(0,o.useRef)(null),[d,h]=(0,o.useState)(0),u=(0,o.useRef)(0),[g,f]=(0,o.useState)({show:!1,content:"",x:0,y:0}),[p,m]=(0,o.useState)(10),x=(0,o.useRef)(null),[y,v]=(0,o.useState)(0);(0,o.useEffect)(()=>{let e=c.current;if(!e)return;let t=new ResizeObserver(e=>{for(let t of e)h(t.contentRect.width)});return t.observe(e),()=>t.disconnect()},[]);let b=(e,t,n,r,o)=>{let l=n+12+r,i=n+12+t-r,s=o(e.start),a=o(e.end),c=(l+i)/2,d=Math.max(o(e.end)-2*r,s),h=Math.min(o(e.start)+2*r,a);if(1==e.strand){let e=""+s+","+l;return e+(" "+d+","+l+(" "+a+",")+c+(" "+d+",")+i+(" "+s+",")+i)}if(-1==e.strand){let e=""+s+","+c;return e+(" "+h+","+l+(" "+a+",")+l+(" "+a+",")+i+(" "+h+",")+i)}if(0==e.strand){let e=""+s+","+l;return e+(" "+a+","+l+(" "+a+",")+i+(" "+s+",")+i)}},j=(e,t,n,r,o)=>{let l=n+12+t-r,i=o(e.start),s=o(e.end),a=""+i+","+l;return a+(" "+(i+s)/2+","+(n+12+r)+(" "+s+",")+l+(" "+i+",")+l)},_=(e,t,n,r,o)=>{let l=n+12+r,i=n+12+t-r,s=o(e.start),a=o(e.end),c=(s+a)/2,d=(l+i)/2,h=""+s+","+d;return h+(" "+c+","+l+(" "+a+",")+d+(" "+c+",")+i+(" "+s+",")+d)},S=(e,t,n,r,o,l,a,c,d,h,u,g)=>{let p=e.contigLength,m=l(0),y=Number(l(p*(e.start+e.end>0?1:-1))),v=function(n,r,o){t.selectAll("polygon.orthoplot-gene-"+n).data(o).enter().append("polygon").attr("points",function(e){return r(e,d,u*a,g,l)}).attr("class",function(e){return"orthoplot-type-"+e.type+" orthoplot-gene-"+n+" orthoplot-gene"}).attr("id",function(t){return c+"-cluster"+e.idx+"-"+N(t.geneName)+"-orf"}).attr("name",function(e){return e.ortho_tag?e.ortho_tag:null}).attr("style",function(e){if(void 0!==e.color&&"CDS"==e.type)return"fill:"+e.color}).on("mouseover",function(e,t){let n=t.ortho_tag,r=(n?"ortho_tag="+n+"<br>":"")+t.description;f({show:!0,content:r,x:e.pageX+10,y:e.pageY-10}),x.current.innerHTML=r}).on("mouseout",()=>{f(e=>({...e,show:!1}))}).on("dblclick",function(e,t){let n=i.Ys(e.target).datum();s(e,n)})};t.append("line").attr("x1",Math.min(h,Math.max(m,0))).attr("y1",u*a+12+d/2).attr("x2",Math.max(0,Math.min(h,y))).attr("y2",u*a+12+d/2).attr("class","orthoplot-line"),v("CDS",b,n),v("RNA",j,o),v("repeat",_,r)},w=()=>{if(!n)return;let e=y*p,t=n.slice(e,e+p),r=i.Ys(a.current),o=l+24;r.selectAll("*").remove();let s=r.attr("height",o*t.length).attr("width","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${d} ${o*t.length}`),c=[],h=[],g=[];t.forEach((e,t)=>{c.push(...e.genes.filter(e=>"CDS"===e.type)),h.push(...e.genes.filter(e=>e.type.match(/RNA/))),g.push(...e.genes.filter(e=>e.type.match(/repeat/)));let n=u.current++,r=l/10,a=i.BYU().domain([e.start,e.end]).range([0,d]);S(e,s,c,g,h,a,t,n,l,d,o,r),e.label&&s.append("text").text(e.label).attr("class","orthoplot-clusterlabel").attr("x",function(){return d-this.getComputedTextLength()-5}).attr("y",()=>o*t+12).attr("font-size",12)})},N=e=>e.replace(/(:|\.)/g,"-").replace(/-orf/g,"_orf");return(0,o.useEffect)(()=>{w()},[n,l,d,p,y]),(0,r.jsxs)(r.Fragment,{children:[(()=>{if((null==n?void 0:n.length)<=10)return null;let e=Math.ceil(n.length/p),t=(y+1)*p<n.length,o=y>0;return(0,r.jsxs)("div",{style:{textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,r.jsx)("button",{onClick:()=>v(y-1),disabled:!o,style:{opacity:o?1:.5},children:"←"}),(0,r.jsx)("button",{onClick:()=>{m(10),v(0)},style:{fontWeight:10===p?"bold":"normal",margin:"0 5px"},children:"Show 10"}),(0,r.jsx)("button",{onClick:()=>{m(20),v(0)},style:{fontWeight:20===p?"bold":"normal",margin:"0 5px"},children:"Show 20"}),n.length>20&&(0,r.jsx)("button",{onClick:()=>{m(50),v(0)},style:{fontWeight:50===p?"bold":"normal",margin:"0 5px"},children:"Show 50"}),(0,r.jsx)("button",{onClick:()=>v(y+1),disabled:!t,style:{opacity:t?1:.5},children:"→"}),(0,r.jsxs)("span",{style:{marginLeft:"10px"},children:["Page ",y+1," of ",e]})]})})(),(0,r.jsx)("div",{id:t,ref:c,style:{overflow:"hidden",border:"1px solid #ccc",height:"fit-content",userSelect:"none",width:"100%"},children:(0,r.jsx)("svg",{ref:a})}),(0,r.jsx)("div",{className:"tooltip",style:{position:"fixed",left:g.x,top:g.y,opacity:.9*!!g.show,pointerEvents:"none",backgroundColor:"lightgray",border:"1px solid #ccc",padding:"5px",borderRadius:"4px",boxShadow:"2px 2px 4px rgba(0,0,0,0.1)",display:g.show?"block":"none"},ref:x})]})};var d=n(256),h=n(7412),u=n(749);class g{set_attr(e,t){this[e]=t}to_dict(){return Object.assign({},this)}to_json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return JSON.stringify(this,null,e)}toString(){return JSON.stringify(this.to_dict())}}class f extends g{addContig(e){this.contigs.push(e)}to_dict(){let e={genomeName:this.genomeName,contigs:this.contigs};return Object.keys(this).forEach(t=>{"genomeName"!==t&&"contigs"!==t&&(e[t]=this[t])}),e}constructor(e){super(),(0,h._)(this,"genomeName",void 0),(0,h._)(this,"contigs",[]),this.genomeName=e}}class p extends g{addGene(e){this.genes.push(e)}constructor(e){super(),(0,h._)(this,"contigName",void 0),(0,h._)(this,"genes",[]),this.contigName=e}}class m extends g{constructor(e,t,n,r,o,l=""){super(),(0,h._)(this,"geneName",void 0),(0,h._)(this,"start",void 0),(0,h._)(this,"end",void 0),(0,h._)(this,"strand",void 0),(0,h._)(this,"description",void 0),(0,h._)(this,"type",void 0),this.geneName=e,this.start=t,this.end=n,this.strand=r,this.type=o,this.description=l}}var x=n(9891),y=n(3333),v=n(8192),b=n(2504),j=n(7230),_=n(2149);l.createRoot(document.getElementById("root")).render((0,r.jsx)(o.StrictMode,{children:(0,r.jsx)(_.VK,{children:(0,r.jsx)(function(){var e;let[t,n]=(0,o.useState)(5e3),[l,s]=(0,o.useState)(20),[h,g]=(0,o.useState)(null),[_,S]=(0,o.useState)({}),[w,N]=(0,o.useState)([]),[O,C]=(0,o.useState)(""),[F,E]=(0,o.useState)([]),[k,R]=(0,o.useState)([]),[M,D]=(0,o.useState)({open:!1,position:{x:0,y:0},gene:null}),[A,$]=(0,o.useState)(""),P=(0,o.useRef)(null),T=(0,o.useRef)(null);(0,o.useEffect)(()=>{h&&N([...new Set(a().query(h,"$..ortho_tag").filter(Boolean))])},[h]),(0,o.useEffect)(()=>{h&&O&&(console.log("genomeObjs:",h),Z())},[h,O,_]),(0,o.useEffect)(()=>{_&&h&&(console.log("Applying orthos to genomeObjs..."),h.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{_[e.geneName]&&(e.ortho_tag=_[e.geneName])})})}))},[_]),(0,o.useEffect)(()=>{h&&O&&Z()},[t,l]);let W=()=>{D(e=>({...e,open:!1})),$("")},I=(e,t)=>h?h.map(function(n){let r=n.genomeName,o=n.speciesName;return n.contigs.map(function(n){let l=n.contigName,i=n.contigLength;return n.genes.filter(t=>t.ortho_tag==e).map(function(e){let s=Math.floor(.5*(e.start+e.end));return -1==e.strand?{start:-s-t,end:-s+t,idx:r,label:r+":"+l+"(-) "+o,contigLength:i,genes:n.genes.filter(e=>-e.start>=-s-t&&-e.end<=-s+t).map(e=>({geneName:e.geneName,start:-e.end,end:-e.start,strand:-1*e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}:{start:s-t,end:s+t,idx:r,label:r+":"+l+"(+) "+o,contigLength:i,genes:n.genes.filter(e=>e.end>=s-t&&e.start<=s+t).map(e=>({geneName:e.geneName,start:e.start,end:e.end,strand:e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}})})}).flat(2):(console.error("genomeObjs is null or undefined"),[]),z=(e,t)=>{let n=e.filter(e=>"#FFFFFF"!=e.color).filter(e=>t.includes(e.ortho_tag)),r=i.UCG.filter(e=>!n.map(e=>e.color).includes(e));return t.filter(e=>!n.map(e=>e.ortho_tag).includes(e)).map(function(e,t){return[{ortho_tag:e,color:r[t]}]}).flat().filter(e=>e.color).concat(n)},L=(0,o.useCallback)((e,t)=>{let n=I(e,t),r=a().query(n,"$..ortho_tag"),o=r.reduce((e,t)=>(t&&(e[t]=(e[t]||0)+1),e),{}),l=z(F,[...new Set(r)].filter(Boolean).sort((e,t)=>o[t]-o[e]));return console.log(F),E(l),n.forEach(e=>{e.genes.forEach(e=>{let t=l.find(t=>t.ortho_tag===e.ortho_tag);e.color=t?t.color:"#FFFFFF"})}),n},[F]),Z=()=>{let e=L(O,t);console.log("Clusters:",e),R(e)},G=(e,t)=>{if(null==e||e.preventDefault(),!t){alert("Empty value");return}C(t),Z()},Y=e=>t=>{e(parseInt(t.target.value)),Z()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginTop:"1em"},children:[(0,r.jsx)("div",{id:"cluster",ref:P,style:{flexGrow:1},children:(0,r.jsx)(c,{id:"orthoplot",clusters:k,height:l,dblclickedOn:(e,t)=>{D({open:!0,position:{x:e.pageX,y:e.pageY},gene:t})}})}),(0,r.jsxs)("div",{className:"div-floater",ref:T,children:[(0,r.jsx)("form",{onSubmit:e=>e.preventDefault(),children:(0,r.jsx)(x.Z,{value:O||"",onChange:(e,t)=>G(e,t),options:w,renderInput:e=>(0,r.jsx)(y.Z,{...e,label:"Enter orthoID",variant:"outlined",size:"small",fullWidth:!0}),sx:{mb:2}})}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"panelHeight",children:["Panel Height: ",l]}),(0,r.jsx)("input",{type:"range",id:"panelHeight",min:"5",max:"100",value:l,onChange:Y(s)})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"flankSize",children:["Flanking region Size (bp): ",t]}),(0,r.jsx)("input",{type:"range",id:"flankSize",min:"1000",max:"100000",value:t,onChange:Y(n)})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"gffDirectory",children:"GFF Directory: "}),(0,r.jsx)("input",{type:"file",id:"gffDirectory",webkitdirectory:"true",directory:"true",multiple:!0,onChange:e=>{let t=Array.from(e.target.files).filter(e=>e.name.endsWith(".gff")||e.name.endsWith(".gff3"));if(0===t.length){alert("No .gff or .gff3 files found");return}let n=[];t.forEach(e=>{let t=new FileReader;t.onload=t=>{let r=t.target.result,o=function(e,t){let n=new f(e),r={};for(let e of t.split("\n"))if(e.startsWith("##sequence-region")){let t=e.split(/\s+/);if(t.length>=3){let e=t[1],n=parseInt(t[3],10);r[e]=n}}let o=(0,u.X)(t);var l={},i=-1;return o.forEach(e=>{let t=e[0].seq_id;l[t]||(l[t]=new p(t)),l[t].set_attr("contigLength",r[t]||0);let n=e[0].type,o=e[0].start-1,s=e[0].end,a="+"===e[0].strand?1:"-"===e[0].strand?-1:0,c=[`pos=${o}-${s}`];Object.entries(e[0].attributes).forEach(e=>{let[t,n]=e;!["source","phase"].includes(t)&&Array.isArray(n)&&c.push(`${t}=${n[0]}`)});var d=e[0].attributes.ID?e[0].attributes.ID[0]:`unknown_${o}_${s}`;"repeat_region"===n?(i+=1,d=`${t}_repeat_${i}`):i=-1;let h=new m(d,o,s,a,n,c.join("<br>"));l[t].addGene(h)}),Object.values(l).forEach(e=>{n.addContig(e)}),n}(e.name.split(".")[0],r);n.push(o)},t.readAsText(e)}),g(n)},accept:".gff,.gff3"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"txtFile",children:"Orthos File: "}),(0,r.jsx)("input",{type:"file",id:"txtFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".txt")){alert("Please select a .txt file");return}let n=new FileReader;n.onload=e=>{let t=e.target.result.split("\n"),n={};for(let e of t){if(""===e.trim()||e.startsWith("#"))continue;let t=e.split(/\s+/);if(t.length>=2){let e=t[0],r=t[1];n[e]=r}}S(n)},n.readAsText(t)},accept:".txt"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"jsonFile",children:"JSON File: "}),(0,r.jsx)("input",{type:"file",id:"jsonFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".json")){alert("Please select a .json file");return}let n=new FileReader;n.onload=e=>{try{let t=JSON.parse(e.target.result);t[0]&&t[0].contigs&&console.log("First 5 contigs:",t[0].contigs.slice(0,5).map(e=>{var t;return{name:e.contigName,length:e.contigLength,geneCount:(null===(t=e.genes)||void 0===t?void 0:t.length)||0}})),g(t);let n=a().query(t,"$..ortho_tag");C(n[0])}catch(e){alert("Invalid JSON file format"),console.error("Error parsing JSON:",e)}},n.readAsText(t)},accept:".json"})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("button",{className:"btn btn-primary",onClick:()=>{let e={filename:`GeneNeighborhood_${Date.now()}`};d.save(i.Ys("svg").node(),e)},children:[(0,r.jsx)("i",{className:"fa fa-download"})," Download SVG"]})]})]}),(0,r.jsxs)(v.Z,{open:M.open,onClose:W,anchorReference:"anchorPosition",anchorPosition:M.open?{top:M.position.y,left:M.position.x}:void 0,children:[(0,r.jsx)(b.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px"},children:[(0,r.jsx)(y.Z,{label:"New Ortho Tag",value:A,onChange:e=>$(e.target.value),size:"small",fullWidth:!0,sx:{mb:1}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,r.jsx)(j.Z,{size:"small",onClick:W,children:"Cancel"}),(0,r.jsx)(j.Z,{variant:"contained",size:"small",onClick:()=>{if(!M.gene||!A)return;let e=[...h];e.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{e.geneName===M.gene.geneName&&(e.ortho_tag=A)})})}),g(e),C(A),W(),Z()},disabled:!A,children:"Add & Center"})]})]})}),(null===(e=M.gene)||void 0===e?void 0:e.ortho_tag)&&(0,r.jsx)(b.Z,{onClick:()=>{C(M.gene.ortho_tag),W(),Z()},children:"Center on this OrthoID"})]})]})},{})})}))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var l=t[r]={exports:{}};return e[r].call(l.exports,l,l.exports,n),l.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o||"object"==typeof r&&r&&(4&o&&r.__esModule||16&o&&"function"==typeof r.then))return r;var l=Object.create(null);n.r(l);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>{i[e]=()=>r[e]});return i.default=()=>r,n.d(l,i),l}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},(()=>{n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,r,o,l)=>{if(r){l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[r,o,l];return}for(var s=1/0,i=0;i<e.length;i++){for(var[r,o,l]=e[i],a=!0,c=0;c<r.length;c++)(!1&l||s>=l)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(a=!1,l<s&&(s=l));if(a){e.splice(i--,1);var d=o();void 0!==d&&(t=d)}}return t}})(),n.rv=()=>"1.2.8",(()=>{var e={980:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,l,[i,s,a]=r,c=0;if(i.some(t=>0!==e[t])){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(a)var d=a(n)}for(t&&t(r);c<i.length;c++)l=i[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},r=self.webpackChunksample_app=self.webpackChunksample_app||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.2.8";var r=n.O(void 0,["361","118","514"],function(){return n(7985)});r=n.O(r)})();