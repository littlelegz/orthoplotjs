(()=>{"use strict";var e={1192:function(e,t,n){var r=n(5893),i=n(7294),l=n(745),s=n(8649),a=n(9832),o=n.n(a);let c=e=>{let{id:t,clusters:n,height:l,dblclickedOn:a}=e,o=(0,i.useRef)(null),c=(0,i.useRef)(null),[d,g]=(0,i.useState)(0),h=(0,i.useRef)(0),[u,p]=(0,i.useState)({show:!1,content:"",x:0,y:0}),[f,x]=(0,i.useState)(10),m=(0,i.useRef)(null),[v,y]=(0,i.useState)(0),[j,b]=(0,i.useState)("");(0,i.useEffect)(()=>{let e=c.current;if(!e)return;let t=new ResizeObserver(e=>{for(let t of e)g(t.contentRect.width)});return t.observe(e),()=>t.disconnect()},[]);let N=(e,t,n,r,i)=>{let l=n+12+r,s=n+12+t-r,a=i(e.start),o=i(e.end),c=(l+s)/2,d=Math.max(i(e.end)-2*r,a),g=Math.min(i(e.start)+2*r,o);if(1==e.strand){let e=""+a+","+l;return e+(" "+d+","+l+(" "+o+",")+c+(" "+d+",")+s+(" "+a+",")+s)}if(-1==e.strand){let e=""+a+","+c;return e+(" "+g+","+l+(" "+o+",")+l+(" "+o+",")+s+(" "+g+",")+s)}if(0==e.strand){let e=""+a+","+l;return e+(" "+o+","+l+(" "+o+",")+s+(" "+a+",")+s)}},_=(e,t,n,r,i)=>{let l=n+12+t-r,s=i(e.start),a=i(e.end),o=""+s+","+l;return o+(" "+(s+a)/2+","+(n+12+r)+(" "+a+",")+l+(" "+s+",")+l)},S=(e,t,n,r,i)=>{let l=n+12+r,s=n+12+t-r,a=i(e.start),o=i(e.end),c=(a+o)/2,d=(l+s)/2,g=""+a+","+d;return g+(" "+c+","+l+(" "+o+",")+d+(" "+c+",")+s+(" "+a+",")+d)},w=(e,t,n,r,i,l,o,c,d,g,h,u)=>{let f=e.contigLength,x=l(0),v=Number(l(f*(e.start+e.end>0?1:-1))),y=function(n,r,i){t.selectAll("polygon.orthoplot-gene-"+n).data(i).enter().append("polygon").attr("points",function(e){return r(e,d,h*o,u,l)}).attr("class",function(e){return"orthoplot-type-"+e.type+" orthoplot-gene-"+n+" orthoplot-gene"}).attr("id",function(t){return c+"-cluster"+e.idx+"-"+O(t.geneName)+"-orf"}).attr("name",function(e){return e.ortho_tag?e.ortho_tag:null}).attr("style",function(e){if(void 0!==e.color&&"CDS"==e.type)return"fill:"+e.color}).on("mouseover",function(e,t){let n=t.ortho_tag,r=(n?"ortho_tag="+n+"<br>":"")+t.description;p({show:!0,content:r,x:e.pageX+10,y:e.pageY-10}),m.current.innerHTML=r}).on("mouseout",()=>{p(e=>({...e,show:!1}))}).on("dblclick",function(e,t){let n=s.Ys(e.target).datum();a(e,n)})};t.append("line").attr("x1",Math.min(g,Math.max(x,0))).attr("y1",h*o+12+d/2).attr("x2",Math.max(0,Math.min(g,v))).attr("y2",h*o+12+d/2).attr("class","orthoplot-line"),y("CDS",N,n),y("RNA",_,i),y("repeat",S,r)},C=()=>{if(!n)return;let e=v*f,t=n.slice(e,e+f),r=s.Ys(o.current),i=l+24;r.selectAll("*").remove();let a=r.attr("height",i*t.length).attr("width","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${d} ${i*t.length}`),c=[],g=[],u=[];t.forEach((e,t)=>{c.push(...e.genes.filter(e=>"CDS"===e.type)),g.push(...e.genes.filter(e=>e.type.match(/RNA/))),u.push(...e.genes.filter(e=>e.type.match(/repeat/)));let n=h.current++,r=l/10,o=s.BYU().domain([e.start,e.end]).range([0,d]);w(e,a,c,u,g,o,t,n,l,d,i,r),e.label&&a.append("text").text(e.label).attr("class","orthoplot-clusterlabel").attr("x",function(){return d-this.getComputedTextLength()-5}).attr("y",()=>i*t+12).attr("font-size",12)})},O=e=>e.replace(/(:|\.)/g,"-").replace(/-orf/g,"_orf");(0,i.useEffect)(()=>{C()},[n,l,d,f,v]),(0,i.useEffect)(()=>{y(0)},[n]);let F=e=>{b(e.target.value)},k=e=>{if("Enter"===e.key){let t=Math.ceil(n.length/f),r=parseInt(e.target.value);isNaN(r)||r<1?y(0):r>t?y(t-1):y(r-1),b("")}};return(0,r.jsxs)("div",{style:{height:"85vh",display:"flex",flexDirection:"column",padding:"10px",boxSizing:"border-box"},children:[(()=>{if((null==n?void 0:n.length)<=10)return null;let e=Math.ceil(n.length/f),t=(v+1)*f<n.length,i=v>0;return(0,r.jsx)("div",{className:"pagination-controls",children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[(0,r.jsx)("button",{className:"pagination-button",onClick:()=>y(v-1),disabled:!i,children:"←"}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,r.jsx)("button",{className:`pagination-button ${10===f?"active":""}`,onClick:()=>{x(10),y(0)},children:"10"}),(0,r.jsx)("button",{className:`pagination-button ${20===f?"active":""}`,onClick:()=>{x(20),y(0)},children:"20"}),n.length>20&&(0,r.jsx)("button",{className:`pagination-button ${50===f?"active":""}`,onClick:()=>{x(50),y(0)},children:"50"})]}),(0,r.jsx)("button",{className:"pagination-button",onClick:()=>y(v+1),disabled:!t,children:"→"}),(0,r.jsxs)("div",{className:"pagination-info",style:{display:"flex",alignItems:"center",gap:"4px"},children:["Page ",(0,r.jsx)("input",{type:"text",value:j,onChange:F,onKeyDown:k,placeholder:v+1,style:{width:"40px",padding:"4px",borderRadius:"4px",border:"1px solid #e0e0e0",textAlign:"center"}})," of ",e]})]})})})(),(0,r.jsx)("div",{id:t,ref:c,style:{flex:1,border:"1px solid #ccc",overflow:"auto",userSelect:"none",width:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsx)("svg",{ref:o,style:{minHeight:"min-content"}})}),(0,r.jsx)("div",{className:"tooltip",style:{position:"fixed",left:u.x,top:u.y,opacity:.9*!!u.show,pointerEvents:"none",backgroundColor:"lightgray",border:"1px solid #ccc",padding:"5px",borderRadius:"4px",boxShadow:"2px 2px 4px rgba(0,0,0,0.1)",display:u.show?"block":"none"},ref:m})]})};var d=n(256),g=n(7412),h=n(749);class u{set_attr(e,t){this[e]=t}to_dict(){return Object.assign({},this)}to_json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return JSON.stringify(this,null,e)}toString(){return JSON.stringify(this.to_dict())}}class p extends u{addContig(e){this.contigs.push(e)}to_dict(){let e={genomeName:this.genomeName,contigs:this.contigs};return Object.keys(this).forEach(t=>{"genomeName"!==t&&"contigs"!==t&&(e[t]=this[t])}),e}constructor(e){super(),(0,g._)(this,"genomeName",void 0),(0,g._)(this,"contigs",[]),this.genomeName=e}}class f extends u{addGene(e){this.genes.push(e)}constructor(e){super(),(0,g._)(this,"contigName",void 0),(0,g._)(this,"genes",[]),this.contigName=e}}class x extends u{constructor(e,t,n,r,i,l=""){super(),(0,g._)(this,"geneName",void 0),(0,g._)(this,"start",void 0),(0,g._)(this,"end",void 0),(0,g._)(this,"strand",void 0),(0,g._)(this,"description",void 0),(0,g._)(this,"type",void 0),this.geneName=e,this.start=t,this.end=n,this.strand=r,this.type=i,this.description=l}}var m=n(9891),v=n(4817),y=n(2401),j=n(2504),b=n(7230),N=n(9836),_=n(7674),S=n(1864),w=n(7454),C=n(1215),O=n(2149);l.createRoot(document.getElementById("root")).render((0,r.jsx)(i.StrictMode,{children:(0,r.jsx)(O.VK,{children:(0,r.jsx)(function(){var e,t;let[n,l]=(0,i.useState)(5e3),[a,g]=(0,i.useState)(20),[u,O]=(0,i.useState)(null),[F,k]=(0,i.useState)({}),[E,M]=(0,i.useState)([]),[D,R]=(0,i.useState)(""),[$,I]=(0,i.useState)([]),[P,Z]=(0,i.useState)([]),[z,A]=(0,i.useState)({open:!1,position:{x:0,y:0},gene:null}),[T,H]=(0,i.useState)(""),[W,L]=(0,i.useState)(!1),Y=(0,i.useRef)(null),B=(0,i.useRef)(null);(0,i.useEffect)(()=>{u&&M([...new Set(o().query(u,"$..ortho_tag").filter(Boolean))])},[u]),(0,i.useEffect)(()=>{u&&D&&U()},[u,D]),(0,i.useEffect)(()=>{F&&u&&(O(u.map(e=>({...e,contigs:e.contigs.map(e=>({...e,genes:e.genes.map(e=>({...e,ortho_tag:F[e.geneName]||e.ortho_tag}))}))}))),R(F[Object.keys(F)[0]]||""),U())},[F]),(0,i.useEffect)(()=>{u&&D&&U()},[n,a]);let G=()=>{A(e=>({...e,open:!1})),H("")},J=e=>{var t;(null===(t=z.gene)||void 0===t?void 0:t.ortho_tag)&&(I(t=>t.map(t=>t.ortho_tag===z.gene.ortho_tag?{...t,color:e}:t)),Z(t=>t.map(t=>({...t,genes:t.genes.map(t=>t.ortho_tag===z.gene.ortho_tag?{...t,color:e}:t)}))))},q=(e,t)=>u?u.map(function(n){let r=n.genomeName,i=n.speciesName;return n.contigs.map(function(n){let l=n.contigName,s=n.contigLength;return n.genes.filter(t=>t.ortho_tag==e).map(function(e){let a=Math.floor(.5*(e.start+e.end));return -1==e.strand?{start:-a-t,end:-a+t,idx:r,label:r+":"+l+"(-) "+i,contigLength:s,genes:n.genes.filter(e=>-e.start>=-a-t&&-e.end<=-a+t).map(e=>({geneName:e.geneName,start:-e.end,end:-e.start,strand:-1*e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}:{start:a-t,end:a+t,idx:r,label:r+":"+l+"(+) "+i,contigLength:s,genes:n.genes.filter(e=>e.end>=a-t&&e.start<=a+t).map(e=>({geneName:e.geneName,start:e.start,end:e.end,strand:e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}})})}).flat(2):[],K=(e,t)=>{let n=e.filter(e=>t.includes(e.ortho_tag)),r=t.filter(e=>!n.map(e=>e.ortho_tag).includes(e)),i=[...s.UCG,...s.W1Y,...s.xHP,...s.K2I],l=n.map(e=>e.color),a=i.filter(e=>!l.includes(e));for(;a.length<r.length;){let e=s.B8C(255*Math.random(),255*Math.random(),255*Math.random()).formatHex();a.includes(e)||l.includes(e)||a.push(e)}return[...r.map((e,t)=>({ortho_tag:e,color:a[t]})),...n]},X=(e,t)=>{let n=q(e,t),r=o().query(n,"$..ortho_tag"),i=r.reduce((e,t)=>(t&&(e[t]=(e[t]||0)+1),e),{}),l=K($,[...new Set(r)].filter(Boolean).sort((e,t)=>i[t]-i[e]));return I(l),n.forEach(e=>{e.genes.forEach(e=>{let t=l.find(t=>t.ortho_tag===e.ortho_tag);e.color=t?t.color:"#FFFFFF"})}),n},U=()=>{Z(X(D,n))},V=(e,t)=>{null==e||e.preventDefault(),t&&(R(t),U())},Q=e=>t=>{e(parseInt(t.target.value)),U()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginTop:"1em"},children:[(0,r.jsxs)("div",{className:"cluster-container",ref:Y,children:[(0,r.jsx)("div",{className:"plot-header",children:"Gene Neighborhood Plot"}),(0,r.jsx)(c,{id:"orthoplot",clusters:P,height:a,dblclickedOn:(e,t)=>{A({open:!0,position:{x:e.pageX,y:e.pageY},gene:t})}})]}),(0,r.jsxs)("div",{className:"div-floater",ref:B,children:[(0,r.jsx)("form",{onSubmit:e=>e.preventDefault(),children:(0,r.jsx)(m.Z,{value:D||"",options:E,onKeyDown:e=>{"Enter"===e.key&&e.target.value&&V(e,e.target.value)},onBlur:e=>{e.target.value&&V(e,e.target.value)},renderInput:e=>(0,r.jsx)(v.Z,{...e,label:"Enter orthoID",variant:"outlined",size:"small",fullWidth:!0}),sx:{mb:3}})}),(0,r.jsx)("hr",{className:"section-divider"}),(0,r.jsxs)("div",{className:"slider-container",children:[(0,r.jsxs)("label",{className:"slider-label",children:["Plot Height: ",a]}),(0,r.jsx)("input",{type:"range",id:"panelHeight",min:"5",max:"100",value:a,onChange:Q(g),style:{width:"100%"}})]}),(0,r.jsxs)("div",{className:"slider-container",children:[(0,r.jsxs)("label",{className:"slider-label",children:["Flanking region Size (bp): ",n]}),(0,r.jsx)("input",{type:"range",id:"flankSize",min:"1000",max:"100000",value:n,onChange:Q(l),style:{width:"100%"}})]}),(0,r.jsx)("hr",{className:"section-divider"}),(0,r.jsxs)("div",{className:"file-input-container",children:[(0,r.jsx)("label",{className:"file-input-label",htmlFor:"gffDirectory",children:"GFF Directory"}),(0,r.jsx)("input",{className:"custom-file-input",type:"file",id:"gffDirectory",webkitdirectory:"true",directory:"true",multiple:!0,onChange:e=>{let t=Array.from(e.target.files).filter(e=>e.name.endsWith(".gff")||e.name.endsWith(".gff3"));if(0===t.length){alert("No .gff or .gff3 files found");return}let n=[];t.forEach(e=>{let t=new FileReader;t.onload=t=>{let r=t.target.result,i=function(e,t){let n=new p(e),r={};for(let e of t.split("\n"))if(e.startsWith("##sequence-region")){let t=e.split(/\s+/);if(t.length>=3){let e=t[1],n=parseInt(t[3],10);r[e]=n}}let i=(0,h.X)(t);var l={},s=-1;return i.forEach(e=>{let t=e[0].seq_id;l[t]||(l[t]=new f(t)),l[t].set_attr("contigLength",r[t]||0);let n=e[0].type,i=e[0].start-1,a=e[0].end,o="+"===e[0].strand?1:"-"===e[0].strand?-1:0,c=[`pos=${i}-${a}`];Object.entries(e[0].attributes).forEach(e=>{let[t,n]=e;!["source","phase"].includes(t)&&Array.isArray(n)&&c.push(`${t}=${n[0]}`)});var d=e[0].attributes.ID?e[0].attributes.ID[0]:`unknown_${i}_${a}`;"repeat_region"===n?(s+=1,d=`${t}_repeat_${s}`):s=-1;let g=new x(d,i,a,o,n,c.join("<br>"));l[t].addGene(g)}),Object.values(l).forEach(e=>{n.addContig(e)}),n}(e.name.split(".")[0],r);n.push(i)},t.readAsText(e)}),console.log(n),O(n)},accept:".gff,.gff3"})]}),(0,r.jsxs)("div",{className:"file-input-container",children:[(0,r.jsx)("label",{className:"file-input-label",htmlFor:"txtFile",children:"Orthos File"}),(0,r.jsx)("input",{className:"custom-file-input",type:"file",id:"txtFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".txt")){alert("Please select a .txt file");return}let n=new FileReader;n.onload=e=>{let t=e.target.result.split("\n"),n={};for(let e of t){if(""===e.trim()||e.startsWith("#"))continue;let t=e.split(/\s+/);if(t.length>=2){let e=t[0],r=t[1];n[e]=r}}k(n)},n.readAsText(t)},accept:".txt"})]}),(0,r.jsxs)("div",{className:"file-input-container",children:[(0,r.jsx)("label",{className:"file-input-label",htmlFor:"jsonFile",children:"JSON File"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,r.jsx)("input",{className:"custom-file-input",type:"file",id:"jsonFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".json")){alert("Please select a .json file");return}L(!0);let n=new FileReader;n.onload=e=>{try{let t=JSON.parse(e.target.result);t[0]&&t[0].contigs&&console.log("First 5 contigs:",t[0].contigs.slice(0,5).map(e=>{var t;return{name:e.contigName,length:e.contigLength,geneCount:(null===(t=e.genes)||void 0===t?void 0:t.length)||0}})),O(t);let n=o().query(t,"$..ortho_tag");R(n[0])}catch(e){alert("Invalid JSON file format"),console.error("Error parsing JSON:",e)}finally{L(!1)}},n.onerror=()=>{alert("Error reading file"),L(!1)},n.readAsText(t)},accept:".json",disabled:W}),W&&(0,r.jsx)(C.Z,{size:24})]})]}),(0,r.jsx)("hr",{className:"section-divider"}),(0,r.jsxs)("button",{className:"download-button",onClick:()=>{let e={filename:`GeneNeighborhood_${Date.now()}`};d.save(s.Ys("svg").node(),e)},children:[(0,r.jsx)("i",{className:"fa fa-download"}),"Download SVG"]})]})]}),(0,r.jsxs)(y.Z,{open:z.open,onClose:G,anchorReference:"anchorPosition",anchorPosition:z.open?{top:z.position.y,left:z.position.x}:void 0,children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px"},children:[(0,r.jsx)(v.Z,{label:"New Ortho Tag",value:T,onChange:e=>H(e.target.value),size:"small",fullWidth:!0,sx:{mb:1}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,r.jsx)(b.Z,{size:"small",onClick:G,children:"Cancel"}),(0,r.jsx)(b.Z,{variant:"contained",size:"small",onClick:()=>{if(!z.gene||!T)return;let e=[...u];e.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{e.geneName===z.gene.geneName&&(e.ortho_tag=T)})})}),O(e),R(T),G(),U()},disabled:!T,children:"Add & Center"})]})]})}),(null===(e=z.gene)||void 0===e?void 0:e.ortho_tag)&&(0,r.jsxs)("div",{children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px",width:"200px"},children:[(0,r.jsx)("p",{style:{margin:"0 0 8px 0"},children:"Change Color"}),(0,r.jsx)(N.Ov,{format:"hex",value:(null===(t=$.find(e=>{var t;return e.ortho_tag===(null===(t=z.gene)||void 0===t?void 0:t.ortho_tag)}))||void 0===t?void 0:t.color)||"#FFFFFF",onChange:J})]})}),(0,r.jsxs)(j.Z,{onClick:()=>J("#FFFFFF"),sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(S.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Clear Color"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{R(z.gene.ortho_tag),G(),U()},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(_.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Center"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{z.gene&&u&&(O(u.map(e=>({...e,contigs:e.contigs.filter(e=>!e.genes.some(e=>e.geneName===z.gene.geneName))}))),G(),U())},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,r.jsx)(w.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Delete Contig"})]})]})]})]})},{})})}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var l=t[r]={exports:{}};return e[r].call(l.exports,l,l.exports,n),l.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i||"object"==typeof r&&r&&(4&i&&r.__esModule||16&i&&"function"==typeof r.then))return r;var l=Object.create(null);n.r(l);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>{s[e]=()=>r[e]});return s.default=()=>r,n.d(l,s),l}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},(()=>{n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,r,i,l)=>{if(r){l=l||0;for(var s=e.length;s>0&&e[s-1][2]>l;s--)e[s]=e[s-1];e[s]=[r,i,l];return}for(var a=1/0,s=0;s<e.length;s++){for(var[r,i,l]=e[s],o=!0,c=0;c<r.length;c++)(!1&l||a>=l)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(o=!1,l<a&&(a=l));if(o){e.splice(s--,1);var d=i();void 0!==d&&(t=d)}}return t}})(),n.rv=()=>"1.2.8",(()=>{var e={980:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var i,l,[s,a,o]=r,c=0;if(s.some(t=>0!==e[t])){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(o)var d=o(n)}for(t&&t(r);c<s.length;c++)l=s[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},r=self.webpackChunksample_app=self.webpackChunksample_app||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.2.8";var r=n.O(void 0,["361","118","425"],function(){return n(1192)});r=n.O(r)})();