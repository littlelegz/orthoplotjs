(()=>{"use strict";var e={985:function(e,t,r){var n=r(893),o=r(294),a=r(745),s=r(212),i=r(832),l=r.n(i);let d=e=>{let{id:t,clusters:r,height:a,width:i}=e,l=(0,o.useRef)(null),d=(0,o.useRef)(0),[c,u]=(0,o.useState)({show:!1,content:"",x:0,y:0}),h=(0,o.useRef)(null),f=(e,t,r,n,o)=>{let a=r+12+n,s=r+12+t-n,i=o(e.start),l=o(e.end),d=(a+s)/2,c=Math.max(o(e.end)-2*n,i),u=Math.min(o(e.start)+2*n,l);if(1==e.strand){let e=""+i+","+a;return e+(" "+c+","+a+(" "+l+",")+d+(" "+c+",")+s+(" "+i+",")+s)}if(-1==e.strand){let e=""+i+","+d;return e+(" "+u+","+a+(" "+l+",")+a+(" "+l+",")+s+(" "+u+",")+s)}if(0==e.strand){let e=""+i+","+a;return e+(" "+l+","+a+(" "+l+",")+s+(" "+i+",")+s)}},g=(e,t,r,n,o)=>{let a=r+12+t-n,s=o(e.start),i=o(e.end),l=""+s+","+a;return l+(" "+(s+i)/2+","+(r+12+n)+(" "+i+",")+a+(" "+s+",")+a)},p=(e,t,r,n,o)=>{let a=r+12+n,s=r+12+t-n,i=o(e.start),l=o(e.end),d=(i+l)/2,c=(a+s)/2,u=""+i+","+c;return u+(" "+d+","+a+(" "+l+",")+c+(" "+d+",")+s+(" "+i+",")+c)},m=(e,t,r,n,o,a,s,i,l,d,c,m)=>{let x=e.contigLength,v=a(0),b=Number(a(x*(e.start+e.end>0?1:-1))),j=function(r,n,o){t.selectAll("polygon.orthoplot-gene-"+r).data(o).enter().append("polygon").attr("points",function(e){return n(e,l,c*s,m,a)}).attr("class",function(e){return"orthoplot-type-"+e.type+" orthoplot-gene-"+r+" orthoplot-gene"}).attr("id",function(t){return i+"-cluster"+e.idx+"-"+y(t.geneName)+"-orf"}).attr("name",function(e){return e.orthoTag?e.orthoTag:null}).attr("style",function(e){if(void 0!==e.color&&"CDS"==e.type)return"fill:"+e.color}).on("mouseover",function(e,t){let r=t.orthoTag,n=(r?"orthoTag="+r+"<br>":"")+t.description;u({show:!0,content:n,x:e.pageX+10,y:e.pageY-10}),h.current.innerHTML=n}).on("mouseout",()=>{u(e=>({...e,show:!1}))})};t.append("line").attr("x1",Math.min(d,Math.max(v,0))).attr("y1",c*s+12+l/2).attr("x2",Math.max(0,Math.min(d,b))).attr("y2",c*s+12+l/2).attr("class","orthoplot-line"),j("CDS",f,r),j("RNA",g,o),j("repeat",p,n)},x=()=>{if(!r)return;let e=s.Ys(l.current),t=a+24;e.selectAll("*").remove();let n=e.attr("height",t*r.length).attr("width",i),o=[],c=[],u=[];r.forEach((e,r)=>{o.push(...e.genes.filter(e=>"CDS"===e.type)),c.push(...e.genes.filter(e=>e.type.match(/RNA/))),u.push(...e.genes.filter(e=>e.type.match(/repeat/)));let l=d.current++,h=a/10,f=s.BYU().domain([e.start,e.end]).range([0,i]);m(e,n,o,u,c,f,r,l,a,i,t,h),e.label&&n.append("text").text(e.label).attr("class","orthoplot-clusterlabel").attr("x",function(){return i-this.getComputedTextLength()-5}).attr("y",()=>t*r+12).attr("font-size",12)})},y=e=>e.replace(/(:|\.)/g,"-").replace(/-orf/g,"_orf");return(0,o.useEffect)(()=>{x()},[r,a,i]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:t,children:(0,n.jsx)("svg",{ref:l})}),(0,n.jsx)("div",{className:"tooltip",style:{position:"fixed",left:c.x,top:c.y,opacity:.9*!!c.show,pointerEvents:"none",backgroundColor:"lightgray",border:"1px solid #ccc",padding:"5px",borderRadius:"4px",boxShadow:"2px 2px 4px rgba(0,0,0,0.1)",display:c.show?"block":"none"},ref:h})]})};var c=r(256),u=r(412),h=r(749);class f{set_attr(e,t){this[e]=t}to_dict(){return Object.assign({},this)}to_json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return JSON.stringify(this,null,e)}toString(){return JSON.stringify(this.to_dict())}}class g extends f{addContig(e){this.contigs.push(e)}to_dict(){let e={genomeName:this.genomeName,contigs:this.contigs};return Object.keys(this).forEach(t=>{"genomeName"!==t&&"contigs"!==t&&(e[t]=this[t])}),e}constructor(e){super(),(0,u._)(this,"genomeName",void 0),(0,u._)(this,"contigs",[]),this.genomeName=e}}class p extends f{addGene(e){this.genes.push(e)}constructor(e){super(),(0,u._)(this,"contigName",void 0),(0,u._)(this,"genes",[]),this.contigName=e}}class m extends f{constructor(e,t,r,n,o,a=""){super(),(0,u._)(this,"geneName",void 0),(0,u._)(this,"start",void 0),(0,u._)(this,"end",void 0),(0,u._)(this,"strand",void 0),(0,u._)(this,"description",void 0),(0,u._)(this,"type",void 0),this.geneName=e,this.start=t,this.end=r,this.strand=n,this.type=o,this.description=a}}var x=r(193),y=r.n(x),v=r(149);a.createRoot(document.getElementById("root")).render((0,n.jsx)(o.StrictMode,{children:(0,n.jsx)(v.VK,{children:(0,n.jsx)(function(){let[e,t]=(0,o.useState)(5e3),[r,a]=(0,o.useState)(1e3),[i,u]=(0,o.useState)(20),[f,x]=(0,o.useState)(null),[v,b]=(0,o.useState)({}),[j,N]=(0,o.useState)(""),[_,w]=(0,o.useState)([]),[F,S]=(0,o.useState)([]),T=(0,o.useRef)(null),E=(0,o.useRef)(null),O=(0,o.useRef)(null);(0,o.useEffect)(()=>{fetch("data.json").then(e=>e.json()).then(e=>{x(e),N(l().query(e,"$..orthoTag")[0])}),window.onbeforeunload=()=>"Data will be lost if you refresh the page, are you sure?"},[]),(0,o.useEffect)(()=>{f&&j&&R()},[f,j,v]),(0,o.useEffect)(()=>{v&&f&&(console.log("Applying orthos to genomeObjs..."),f.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{v[e.geneName]&&(e.orthoTag=v[e.geneName])})})}))},[v]),(0,o.useEffect)(()=>{f&&j&&R()},[e,i,r]);let C=(e,t)=>f?f.map(function(r){let n=r.genomeName,o=r.speciesName;return r.contigs.map(function(r){let a=r.contigName,s=r.contigLength;return r.genes.filter(t=>t.orthoTag==e).map(function(e){let i=Math.floor(.5*(e.start+e.end));return -1==e.strand?{start:-i-t,end:-i+t,idx:n,label:n+":"+a+"(-) "+o,contigLength:s,genes:r.genes.filter(e=>-e.start>=-i-t&&-e.end<=-i+t).map(e=>({geneName:e.geneName,start:-e.end,end:-e.start,strand:-1*e.strand,orthoTag:e.orthoTag,description:e.description,type:e.type}))}:{start:i-t,end:i+t,idx:n,label:n+":"+a+"(+) "+o,contigLength:s,genes:r.genes.filter(e=>e.end>=i-t&&e.start<=i+t).map(e=>({geneName:e.geneName,start:e.start,end:e.end,strand:e.strand,orthoTag:e.orthoTag,description:e.description,type:e.type}))}})})}).flat(2):[],k=(e,t)=>{let r=e.filter(e=>"#FFFFFF"!=e.color).filter(e=>t.includes(e.orthoTag)),n=s.UCG.filter(e=>!r.map(e=>e.color).includes(e));return t.filter(e=>!r.map(e=>e.orthoTag).includes(e)).map(function(e,t){return[{orthoTag:e,color:n[t]}]}).flat().filter(e=>e.color).concat(r)},D=(0,o.useCallback)((e,t)=>{let r=C(e,t),n=l().query(r,"$..orthoTag"),o=n.reduce((e,t)=>(t&&(e[t]=(e[t]||0)+1),e),{}),a=k(_,[...new Set(n)].filter(Boolean).sort((e,t)=>o[t]-o[e]));return w(a),r.forEach(e=>{e.genes.forEach(e=>{let t=a.find(t=>t.orthoTag===e.orthoTag);e.color=t?t.color:"#FFFFFF"})}),r},[_]),R=()=>{S(D(j,e))},$=e=>t=>{e(parseInt(t.target.value)),R()};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"cluster",ref:T,style:{position:"absolute",left:20,top:20},children:(0,n.jsx)(d,{id:"orthoplot",clusters:F,height:i,width:r})}),(0,n.jsx)(y(),{axis:"both",nodeRef:O,handle:".drag-handle",defaultPosition:{x:20,y:20},children:(0,n.jsxs)("div",{className:"div-floater",ref:O,children:[(0,n.jsx)("div",{className:"drag-handle",style:{cursor:"move",borderBottom:"1px solid #ccc"},children:"⋮⋮ Drag to move"}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=E.current.value;if(!t){alert("Empty value");return}if(!l().query(f,"$..orthoTag").includes(t)){alert(`Cannot find ${t} in the genomes`);return}N(t),R()},children:(0,n.jsxs)("p",{children:["Enter orthoID",(0,n.jsx)("input",{type:"text",ref:E,onFocus:e=>e.target.value=""}),(0,n.jsx)("input",{type:"submit",value:"Go"})]})}),(0,n.jsx)("hr",{}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{htmlFor:"panelWidth",children:["Panel Width: ",r]}),(0,n.jsx)("input",{type:"range",id:"panelWidth",min:"100",max:"2000",value:r,onChange:$(a)})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{htmlFor:"panelHeight",children:["Panel Height: ",i]}),(0,n.jsx)("input",{type:"range",id:"panelHeight",min:"5",max:"100",value:i,onChange:$(u)})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{htmlFor:"flankSize",children:["Flanking region Size (bp): ",e]}),(0,n.jsx)("input",{type:"range",id:"flankSize",min:"1000",max:"100000",value:e,onChange:$(t)})]}),(0,n.jsx)("hr",{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"gffDirectory",children:"GFF Directory: "}),(0,n.jsx)("input",{type:"file",id:"gffDirectory",webkitdirectory:"true",directory:"true",multiple:!0,onChange:e=>{let t=Array.from(e.target.files).filter(e=>e.name.endsWith(".gff")||e.name.endsWith(".gff3"));if(0===t.length){alert("No .gff or .gff3 files found");return}let r=[];t.forEach(e=>{let t=new FileReader;t.onload=t=>{let n=t.target.result,o=function(e,t){let r=new g(e),n={};for(let e of t.split("\n"))if(e.startsWith("##sequence-region")){let t=e.split(/\s+/);if(t.length>=3){let e=t[1],r=parseInt(t[3],10);n[e]=r}}let o=(0,h.X)(t);var a={},s=-1;return o.forEach(e=>{let t=e[0].seq_id;a[t]||(a[t]=new p(t)),a[t].set_attr("contigLength",n[t]||0);let r=e[0].type,o=e[0].start-1,i=e[0].end,l="+"===e[0].strand?1:"-"===e[0].strand?-1:0,d=[`pos=${o}-${i}`];Object.entries(e[0].attributes).forEach(e=>{let[t,r]=e;!["source","phase"].includes(t)&&Array.isArray(r)&&d.push(`${t}=${r[0]}`)});var c=e[0].attributes.ID?e[0].attributes.ID[0]:`unknown_${o}_${i}`;"repeat_region"===r?(s+=1,c=`${t}_repeat_${s}`):s=-1;let u=new m(c,o,i,l,r,d.join("<br>"));a[t].addGene(u)}),Object.values(a).forEach(e=>{r.addContig(e)}),r}(e.name.split(".")[0],n);r.push(o)},t.readAsText(e)}),x(r)},accept:".gff,.gff3"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"txtFile",children:"Orthos File: "}),(0,n.jsx)("input",{type:"file",id:"txtFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".txt")){alert("Please select a .txt file");return}let r=new FileReader;r.onload=e=>{let t=e.target.result.split("\n"),r={};for(let e of t){if(""===e.trim()||e.startsWith("#"))continue;let t=e.split(/\s+/);if(t.length>=2){let e=t[0],n=t[1];r[e]=n}}b(r)},r.readAsText(t)},accept:".txt"})]}),(0,n.jsx)("hr",{}),(0,n.jsxs)("button",{className:"btn btn-primary",onClick:()=>{let e={filename:`GeneNeighborhood_${Date.now()}`};c.save(s.Ys("svg").node(),e)},children:[(0,n.jsx)("i",{className:"fa fa-download"})," Download SVG"]})]})})]})},{})})}))}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},(()=>{r.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];r.O=(t,n,o,a)=>{if(n){a=a||0;for(var s=e.length;s>0&&e[s-1][2]>a;s--)e[s]=e[s-1];e[s]=[n,o,a];return}for(var i=1/0,s=0;s<e.length;s++){for(var[n,o,a]=e[s],l=!0,d=0;d<n.length;d++)(!1&a||i>=a)&&Object.keys(r.O).every(e=>r.O[e](n[d]))?n.splice(d--,1):(l=!1,a<i&&(i=a));if(l){e.splice(s--,1);var c=o();void 0!==c&&(t=c)}}return t}})(),r.rv=()=>"1.2.8",(()=>{var e={980:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[s,i,l]=n,d=0;if(s.some(t=>0!==e[t])){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(l)var c=l(r)}for(t&&t(n);d<s.length;d++)a=s[d],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(c)},n=self.webpackChunksample_app=self.webpackChunksample_app||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.ruid="bundler=rspack@1.2.8";var n=r.O(void 0,["361","118","643"],function(){return r(985)});n=r.O(n)})();