(()=>{"use strict";var e={1192:function(e,t,n){var r=n(5893),i=n(7294),s=n(745),o=n(8649),l=n(9832),a=n.n(l);let c=e=>{let{id:t,clusters:n,height:s,dblclickedOn:l}=e,a=(0,i.useRef)(null),c=(0,i.useRef)(null),[d,h]=(0,i.useState)(0),g=(0,i.useRef)(0),[u,p]=(0,i.useState)({show:!1,content:"",x:0,y:0}),[f,m]=(0,i.useState)(10),x=(0,i.useRef)(null),[v,y]=(0,i.useState)(0);(0,i.useEffect)(()=>{let e=c.current;if(!e)return;let t=new ResizeObserver(e=>{for(let t of e)h(t.contentRect.width)});return t.observe(e),()=>t.disconnect()},[]);let j=(e,t,n,r,i)=>{let s=n+12+r,o=n+12+t-r,l=i(e.start),a=i(e.end),c=(s+o)/2,d=Math.max(i(e.end)-2*r,l),h=Math.min(i(e.start)+2*r,a);if(1==e.strand){let e=""+l+","+s;return e+(" "+d+","+s+(" "+a+",")+c+(" "+d+",")+o+(" "+l+",")+o)}if(-1==e.strand){let e=""+l+","+c;return e+(" "+h+","+s+(" "+a+",")+s+(" "+a+",")+o+(" "+h+",")+o)}if(0==e.strand){let e=""+l+","+s;return e+(" "+a+","+s+(" "+a+",")+o+(" "+l+",")+o)}},b=(e,t,n,r,i)=>{let s=n+12+t-r,o=i(e.start),l=i(e.end),a=""+o+","+s;return a+(" "+(o+l)/2+","+(n+12+r)+(" "+l+",")+s+(" "+o+",")+s)},N=(e,t,n,r,i)=>{let s=n+12+r,o=n+12+t-r,l=i(e.start),a=i(e.end),c=(l+a)/2,d=(s+o)/2,h=""+l+","+d;return h+(" "+c+","+s+(" "+a+",")+d+(" "+c+",")+o+(" "+l+",")+d)},_=(e,t,n,r,i,s,a,c,d,h,g,u)=>{let f=e.contigLength,m=s(0),v=Number(s(f*(e.start+e.end>0?1:-1))),y=function(n,r,i){t.selectAll("polygon.orthoplot-gene-"+n).data(i).enter().append("polygon").attr("points",function(e){return r(e,d,g*a,u,s)}).attr("class",function(e){return"orthoplot-type-"+e.type+" orthoplot-gene-"+n+" orthoplot-gene"}).attr("id",function(t){return c+"-cluster"+e.idx+"-"+C(t.geneName)+"-orf"}).attr("name",function(e){return e.ortho_tag?e.ortho_tag:null}).attr("style",function(e){if(void 0!==e.color&&"CDS"==e.type)return"fill:"+e.color}).on("mouseover",function(e,t){let n=t.ortho_tag,r=(n?"ortho_tag="+n+"<br>":"")+t.description;p({show:!0,content:r,x:e.pageX+10,y:e.pageY-10}),x.current.innerHTML=r}).on("mouseout",()=>{p(e=>({...e,show:!1}))}).on("dblclick",function(e,t){let n=o.Ys(e.target).datum();l(e,n)})};t.append("line").attr("x1",Math.min(h,Math.max(m,0))).attr("y1",g*a+12+d/2).attr("x2",Math.max(0,Math.min(h,v))).attr("y2",g*a+12+d/2).attr("class","orthoplot-line"),y("CDS",j,n),y("RNA",b,i),y("repeat",N,r)},S=()=>{if(!n)return;let e=v*f,t=n.slice(e,e+f),r=o.Ys(a.current),i=s+24;r.selectAll("*").remove();let l=r.attr("height",i*t.length).attr("width","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${d} ${i*t.length}`),c=[],h=[],u=[];t.forEach((e,t)=>{c.push(...e.genes.filter(e=>"CDS"===e.type)),h.push(...e.genes.filter(e=>e.type.match(/RNA/))),u.push(...e.genes.filter(e=>e.type.match(/repeat/)));let n=g.current++,r=s/10,a=o.BYU().domain([e.start,e.end]).range([0,d]);_(e,l,c,u,h,a,t,n,s,d,i,r),e.label&&l.append("text").text(e.label).attr("class","orthoplot-clusterlabel").attr("x",function(){return d-this.getComputedTextLength()-5}).attr("y",()=>i*t+12).attr("font-size",12)})},C=e=>e.replace(/(:|\.)/g,"-").replace(/-orf/g,"_orf");return(0,i.useEffect)(()=>{S()},[n,s,d,f,v]),(0,r.jsxs)("div",{style:{height:"85vh",display:"flex",flexDirection:"column",padding:"10px",boxSizing:"border-box"},children:[(()=>{if((null==n?void 0:n.length)<=10)return null;let e=Math.ceil(n.length/f),t=(v+1)*f<n.length,i=v>0;return(0,r.jsx)("div",{className:"pagination-controls",children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[(0,r.jsx)("button",{className:"pagination-button",onClick:()=>y(v-1),disabled:!i,children:"←"}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,r.jsx)("button",{className:`pagination-button ${10===f?"active":""}`,onClick:()=>{m(10),y(0)},children:"10"}),(0,r.jsx)("button",{className:`pagination-button ${20===f?"active":""}`,onClick:()=>{m(20),y(0)},children:"20"}),n.length>20&&(0,r.jsx)("button",{className:`pagination-button ${50===f?"active":""}`,onClick:()=>{m(50),y(0)},children:"50"})]}),(0,r.jsx)("button",{className:"pagination-button",onClick:()=>y(v+1),disabled:!t,children:"→"}),(0,r.jsxs)("span",{className:"pagination-info",children:["Page ",v+1," of ",e]})]})})})(),(0,r.jsx)("div",{id:t,ref:c,style:{flex:1,border:"1px solid #ccc",overflow:"auto",userSelect:"none",width:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsx)("svg",{ref:a,style:{minHeight:"min-content"}})}),(0,r.jsx)("div",{className:"tooltip",style:{position:"fixed",left:u.x,top:u.y,opacity:.9*!!u.show,pointerEvents:"none",backgroundColor:"lightgray",border:"1px solid #ccc",padding:"5px",borderRadius:"4px",boxShadow:"2px 2px 4px rgba(0,0,0,0.1)",display:u.show?"block":"none"},ref:x})]})};var d=n(256),h=n(7412),g=n(749);class u{set_attr(e,t){this[e]=t}to_dict(){return Object.assign({},this)}to_json(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return JSON.stringify(this,null,e)}toString(){return JSON.stringify(this.to_dict())}}class p extends u{addContig(e){this.contigs.push(e)}to_dict(){let e={genomeName:this.genomeName,contigs:this.contigs};return Object.keys(this).forEach(t=>{"genomeName"!==t&&"contigs"!==t&&(e[t]=this[t])}),e}constructor(e){super(),(0,h._)(this,"genomeName",void 0),(0,h._)(this,"contigs",[]),this.genomeName=e}}class f extends u{addGene(e){this.genes.push(e)}constructor(e){super(),(0,h._)(this,"contigName",void 0),(0,h._)(this,"genes",[]),this.contigName=e}}class m extends u{constructor(e,t,n,r,i,s=""){super(),(0,h._)(this,"geneName",void 0),(0,h._)(this,"start",void 0),(0,h._)(this,"end",void 0),(0,h._)(this,"strand",void 0),(0,h._)(this,"description",void 0),(0,h._)(this,"type",void 0),this.geneName=e,this.start=t,this.end=n,this.strand=r,this.type=i,this.description=s}}var x=n(9891),v=n(4817),y=n(2401),j=n(2504),b=n(7230),N=n(9836),_=n(7674),S=n(1864),C=n(7454),w=n(1215),O=n(2149);s.createRoot(document.getElementById("root")).render((0,r.jsx)(i.StrictMode,{children:(0,r.jsx)(O.VK,{children:(0,r.jsx)(function(){var e,t;let[n,s]=(0,i.useState)(5e3),[l,h]=(0,i.useState)(20),[u,O]=(0,i.useState)(null),[F,k]=(0,i.useState)({}),[E,M]=(0,i.useState)([]),[D,R]=(0,i.useState)(""),[$,P]=(0,i.useState)([]),[Z,I]=(0,i.useState)([]),[z,A]=(0,i.useState)({open:!1,position:{x:0,y:0},gene:null}),[T,H]=(0,i.useState)(""),[W,L]=(0,i.useState)(!1),Y=(0,i.useRef)(null),B=(0,i.useRef)(null);(0,i.useEffect)(()=>{u&&M([...new Set(a().query(u,"$..ortho_tag").filter(Boolean))])},[u]),(0,i.useEffect)(()=>{u&&D&&U()},[u,D]),(0,i.useEffect)(()=>{F&&u&&(O(u.map(e=>({...e,contigs:e.contigs.map(e=>({...e,genes:e.genes.map(e=>({...e,ortho_tag:F[e.geneName]||e.ortho_tag}))}))}))),R(F[Object.keys(F)[0]]||""),U())},[F]),(0,i.useEffect)(()=>{u&&D&&U()},[n,l]);let G=()=>{A(e=>({...e,open:!1})),H("")},J=e=>{var t;(null===(t=z.gene)||void 0===t?void 0:t.ortho_tag)&&(P(t=>t.map(t=>t.ortho_tag===z.gene.ortho_tag?{...t,color:e}:t)),I(t=>t.map(t=>({...t,genes:t.genes.map(t=>t.ortho_tag===z.gene.ortho_tag?{...t,color:e}:t)}))))},q=(e,t)=>u?u.map(function(n){let r=n.genomeName,i=n.speciesName;return n.contigs.map(function(n){let s=n.contigName,o=n.contigLength;return n.genes.filter(t=>t.ortho_tag==e).map(function(e){let l=Math.floor(.5*(e.start+e.end));return -1==e.strand?{start:-l-t,end:-l+t,idx:r,label:r+":"+s+"(-) "+i,contigLength:o,genes:n.genes.filter(e=>-e.start>=-l-t&&-e.end<=-l+t).map(e=>({geneName:e.geneName,start:-e.end,end:-e.start,strand:-1*e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}:{start:l-t,end:l+t,idx:r,label:r+":"+s+"(+) "+i,contigLength:o,genes:n.genes.filter(e=>e.end>=l-t&&e.start<=l+t).map(e=>({geneName:e.geneName,start:e.start,end:e.end,strand:e.strand,ortho_tag:e.ortho_tag,description:e.description,type:e.type}))}})})}).flat(2):[],K=(e,t)=>{let n=e.filter(e=>t.includes(e.ortho_tag)),r=t.filter(e=>!n.map(e=>e.ortho_tag).includes(e)),i=[...o.UCG,...o.W1Y,...o.xHP,...o.K2I],s=n.map(e=>e.color),l=i.filter(e=>!s.includes(e));for(;l.length<r.length;){let e=o.B8C(255*Math.random(),255*Math.random(),255*Math.random()).formatHex();l.includes(e)||s.includes(e)||l.push(e)}return[...r.map((e,t)=>({ortho_tag:e,color:l[t]})),...n]},X=(e,t)=>{let n=q(e,t),r=a().query(n,"$..ortho_tag"),i=r.reduce((e,t)=>(t&&(e[t]=(e[t]||0)+1),e),{}),s=K($,[...new Set(r)].filter(Boolean).sort((e,t)=>i[t]-i[e]));return P(s),n.forEach(e=>{e.genes.forEach(e=>{let t=s.find(t=>t.ortho_tag===e.ortho_tag);e.color=t?t.color:"#FFFFFF"})}),n},U=()=>{I(X(D,n))},V=(e,t)=>{null==e||e.preventDefault(),t&&(R(t),U())},Q=e=>t=>{e(parseInt(t.target.value)),U()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginTop:"1em"},children:[(0,r.jsxs)("div",{className:"cluster-container",ref:Y,children:[(0,r.jsx)("div",{className:"plot-header",children:"Gene Neighborhood Plot"}),(0,r.jsx)(c,{id:"orthoplot",clusters:Z,height:l,dblclickedOn:(e,t)=>{A({open:!0,position:{x:e.pageX,y:e.pageY},gene:t})}})]}),(0,r.jsxs)("div",{className:"div-floater",ref:B,children:[(0,r.jsx)("form",{onSubmit:e=>e.preventDefault(),children:(0,r.jsx)(x.Z,{value:D||"",options:E,onKeyDown:e=>{"Enter"===e.key&&e.target.value&&V(e,e.target.value)},onBlur:e=>{e.target.value&&V(e,e.target.value)},renderInput:e=>(0,r.jsx)(v.Z,{...e,label:"Enter orthoID",variant:"outlined",size:"small",fullWidth:!0}),sx:{mb:3}})}),(0,r.jsx)("hr",{className:"section-divider"}),(0,r.jsxs)("div",{className:"slider-container",children:[(0,r.jsxs)("label",{className:"slider-label",children:["Plot Height: ",l]}),(0,r.jsx)("input",{type:"range",id:"panelHeight",min:"5",max:"100",value:l,onChange:Q(h),style:{width:"100%"}})]}),(0,r.jsxs)("div",{className:"slider-container",children:[(0,r.jsxs)("label",{className:"slider-label",children:["Flanking region Size (bp): ",n]}),(0,r.jsx)("input",{type:"range",id:"flankSize",min:"1000",max:"100000",value:n,onChange:Q(s),style:{width:"100%"}})]}),(0,r.jsx)("hr",{className:"section-divider"}),(0,r.jsxs)("div",{className:"file-input-container",children:[(0,r.jsx)("label",{className:"file-input-label",htmlFor:"gffDirectory",children:"GFF Directory"}),(0,r.jsx)("input",{className:"custom-file-input",type:"file",id:"gffDirectory",webkitdirectory:"true",directory:"true",multiple:!0,onChange:e=>{let t=Array.from(e.target.files).filter(e=>e.name.endsWith(".gff")||e.name.endsWith(".gff3"));if(0===t.length){alert("No .gff or .gff3 files found");return}let n=[];t.forEach(e=>{let t=new FileReader;t.onload=t=>{let r=t.target.result,i=function(e,t){let n=new p(e),r={};for(let e of t.split("\n"))if(e.startsWith("##sequence-region")){let t=e.split(/\s+/);if(t.length>=3){let e=t[1],n=parseInt(t[3],10);r[e]=n}}let i=(0,g.X)(t);var s={},o=-1;return i.forEach(e=>{let t=e[0].seq_id;s[t]||(s[t]=new f(t)),s[t].set_attr("contigLength",r[t]||0);let n=e[0].type,i=e[0].start-1,l=e[0].end,a="+"===e[0].strand?1:"-"===e[0].strand?-1:0,c=[`pos=${i}-${l}`];Object.entries(e[0].attributes).forEach(e=>{let[t,n]=e;!["source","phase"].includes(t)&&Array.isArray(n)&&c.push(`${t}=${n[0]}`)});var d=e[0].attributes.ID?e[0].attributes.ID[0]:`unknown_${i}_${l}`;"repeat_region"===n?(o+=1,d=`${t}_repeat_${o}`):o=-1;let h=new m(d,i,l,a,n,c.join("<br>"));s[t].addGene(h)}),Object.values(s).forEach(e=>{n.addContig(e)}),n}(e.name.split(".")[0],r);n.push(i)},t.readAsText(e)}),console.log(n),O(n)},accept:".gff,.gff3"})]}),(0,r.jsxs)("div",{className:"file-input-container",children:[(0,r.jsx)("label",{className:"file-input-label",htmlFor:"txtFile",children:"Orthos File"}),(0,r.jsx)("input",{className:"custom-file-input",type:"file",id:"txtFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".txt")){alert("Please select a .txt file");return}let n=new FileReader;n.onload=e=>{let t=e.target.result.split("\n"),n={};for(let e of t){if(""===e.trim()||e.startsWith("#"))continue;let t=e.split(/\s+/);if(t.length>=2){let e=t[0],r=t[1];n[e]=r}}k(n)},n.readAsText(t)},accept:".txt"})]}),(0,r.jsxs)("div",{className:"file-input-container",children:[(0,r.jsx)("label",{className:"file-input-label",htmlFor:"jsonFile",children:"JSON File"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,r.jsx)("input",{className:"custom-file-input",type:"file",id:"jsonFile",onChange:e=>{let t=e.target.files[0];if(!t||!t.name.endsWith(".json")){alert("Please select a .json file");return}L(!0);let n=new FileReader;n.onload=e=>{try{let t=JSON.parse(e.target.result);t[0]&&t[0].contigs&&console.log("First 5 contigs:",t[0].contigs.slice(0,5).map(e=>{var t;return{name:e.contigName,length:e.contigLength,geneCount:(null===(t=e.genes)||void 0===t?void 0:t.length)||0}})),O(t);let n=a().query(t,"$..ortho_tag");R(n[0])}catch(e){alert("Invalid JSON file format"),console.error("Error parsing JSON:",e)}finally{L(!1)}},n.onerror=()=>{alert("Error reading file"),L(!1)},n.readAsText(t)},accept:".json",disabled:W}),W&&(0,r.jsx)(w.Z,{size:24})]})]}),(0,r.jsx)("hr",{className:"section-divider"}),(0,r.jsxs)("button",{className:"download-button",onClick:()=>{let e={filename:`GeneNeighborhood_${Date.now()}`};d.save(o.Ys("svg").node(),e)},children:[(0,r.jsx)("i",{className:"fa fa-download"}),"Download SVG"]})]})]}),(0,r.jsxs)(y.Z,{open:z.open,onClose:G,anchorReference:"anchorPosition",anchorPosition:z.open?{top:z.position.y,left:z.position.x}:void 0,children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px"},children:[(0,r.jsx)(v.Z,{label:"New Ortho Tag",value:T,onChange:e=>H(e.target.value),size:"small",fullWidth:!0,sx:{mb:1}}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[(0,r.jsx)(b.Z,{size:"small",onClick:G,children:"Cancel"}),(0,r.jsx)(b.Z,{variant:"contained",size:"small",onClick:()=>{if(!z.gene||!T)return;let e=[...u];e.forEach(e=>{e.contigs.forEach(e=>{e.genes.forEach(e=>{e.geneName===z.gene.geneName&&(e.ortho_tag=T)})})}),O(e),R(T),G(),U()},disabled:!T,children:"Add & Center"})]})]})}),(null===(e=z.gene)||void 0===e?void 0:e.ortho_tag)&&(0,r.jsxs)("div",{children:[(0,r.jsx)(j.Z,{children:(0,r.jsxs)("div",{style:{padding:"8px",width:"200px"},children:[(0,r.jsx)("p",{style:{margin:"0 0 8px 0"},children:"Change Color"}),(0,r.jsx)(N.Ov,{format:"hex",value:(null===(t=$.find(e=>{var t;return e.ortho_tag===(null===(t=z.gene)||void 0===t?void 0:t.ortho_tag)}))||void 0===t?void 0:t.color)||"#FFFFFF",onChange:J})]})}),(0,r.jsxs)(j.Z,{onClick:()=>J("#FFFFFF"),sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(S.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Clear Color"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{R(z.gene.ortho_tag),G(),U()},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(_.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Center"})]}),(0,r.jsxs)(j.Z,{onClick:()=>{z.gene&&u&&(O(u.map(e=>({...e,contigs:e.contigs.filter(e=>!e.genes.some(e=>e.geneName===z.gene.geneName))}))),G(),U())},sx:{minHeight:"36px",display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[(0,r.jsx)(C.Z,{fontSize:"small"}),(0,r.jsx)("span",{children:"Delete Contig"})]})]})]})]})},{})})}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i||"object"==typeof r&&r&&(4&i&&r.__esModule||16&i&&"function"==typeof r.then))return r;var s=Object.create(null);n.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var l=2&i&&r;"object"==typeof l&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach(e=>{o[e]=()=>r[e]});return o.default=()=>r,n.d(s,o),s}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},(()=>{n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=(t,r,i,s)=>{if(r){s=s||0;for(var o=e.length;o>0&&e[o-1][2]>s;o--)e[o]=e[o-1];e[o]=[r,i,s];return}for(var l=1/0,o=0;o<e.length;o++){for(var[r,i,s]=e[o],a=!0,c=0;c<r.length;c++)(!1&s||l>=s)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(a=!1,s<l&&(l=s));if(a){e.splice(o--,1);var d=i();void 0!==d&&(t=d)}}return t}})(),n.rv=()=>"1.2.8",(()=>{var e={980:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var i,s,[o,l,a]=r,c=0;if(o.some(t=>0!==e[t])){for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(a)var d=a(n)}for(t&&t(r);c<o.length;c++)s=o[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},r=self.webpackChunksample_app=self.webpackChunksample_app||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.2.8";var r=n.O(void 0,["361","118","425"],function(){return n(1192)});r=n.O(r)})();